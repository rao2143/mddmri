function E = entropy_fun2(Pin,Itemp0,baslpoints,pivotpoint)phc0=Pin(1);phc1=Pin(2);%Itemp = fPhCorr(Itemp0.',phc0,phc1,pivotpoint); Itemp = Itemp.';% si = length(Itemp0);% phcorrfun = exp(i*phc0*pi/180*ones(si,1)+phc1*pi/180*((1:si)'-pivotpoint)./si);% Itemp = Itemp0.*phcorrfun; % Iin = Itemp0.';% pivot = pivotpoint;% %[m,n]=size(Iin);% si = length(Itemp0);% %a=phc0*pi/180.*ones(1,si)+phc1*pi/180*((1:si)-pivot)./si; % calculate a(i,j)% phcorrfun = exp(i*(phc0*pi/180.*ones(1,si)+phc1*pi/180*((1:si)-pivot)./si)); % calculate a(i,j)% %Iout = Iin.*exp(i*a);% Iout = Iin.*phcorrfun;% Itemp = Iout.';% Iin = Itemp0;pivot = pivotpoint;si = length(Itemp0);phcorrfun = exp(i*(phc0*pi/180.*ones(1,si)'+phc1*pi/180*((1:si)'-pivot)./si)); % calculate a(i,j)Iout = Iin.*phcorrfun;Itemp = Iout;Itemp = Itemp - mean(Itemp(baslpoints));ReItemp = real(Itemp);%ReItemp = ReItemp/sum(ReItemp);D1ReItemp = abs(gradient(ReItemp));h = D1ReItemp/sum(D1ReItemp);h(find(h==0)) = 1;H = -sum(h.*log(h));F = zeros(size(ReItemp));F(find(ReItemp<0)) = 1;p = 1e-4/length(Itemp)^2*F.*ReItemp.^2;P = sum(p);E = H + P;%Pin%[H P E]