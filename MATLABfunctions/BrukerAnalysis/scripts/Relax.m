clear allwd = fileparts(mfilename('fullpath'));MkReportFig = 1;SvSpecDataMat = 1;CheckBasline = 0;CheckPeaks = 0;PlotInterm = 1;FindPeaks = 0;thresh = .1;td1start = 1;Imin = 1e-3;signal = 'area';%DataDir = '/Users/daniel/NMRdata/AVII500/DT/';%DataDir = '/Users/daniel/NMRdata/AVII200/';% DataDir = '/opt/topspin2/data/DT/nmr';%DataDir = '/opt/topspin/data/DT/nmr';%DataDir = '/Users/daniel/Dropbox';%DataDir = '/Users/daniel/Documents/Spaces/Presentations';%DataDir = '/Users/daniel/Dropbox/NMRdata/SNC/DNP';% DataDir = '/opt/nmrdata/daniel';DataDir = '/Users/daniel/Dropbox/NMRdata/AV4_500/daniel/';cd(DataDir)ExpNam = {'20230419_mousebrain'}; expno = [8]; thresh = .001;td1start = 2;ll = [66500 65332 64290]'; ul = [68000 65781 65000]';basl = [0.01 .3   .7 .99];lb = 10; si = 128*1024; ppmshift = 0; AutoPhaseAll = 1;expno = [7]; AutoPhaseAll = 0;% ExpNam = {'20220223_POPCGM3AS'};% baslppm = [-21.7779   10.5262   42.8304   50.2852   80.1044  85 97 99.9839  107.4387  127.3182  137.2580  165 180 207 217 221.7458];% lb = 10; si = 8*1024; ppmshift = 0; AutoPhaseAll = 1;% expno = [15:31 65:67 69:82 102:104 106:119 125:126 141:143 145:158 164 166 168 170]; %expno = 170;% ExpNam = {'20220509_POPCGM3'}; % % ExpNam = {'20220110_POPCGM3'};% % % expno = 39:2:49; expno = 79:2:97; expno = 125:2:137; expno = 126:2:138; expno = 248:251; expno = 248:263;% % % basl = [0.01 .14 .27 .3 .42 .5 .53 .61 .65 .99];% baslppm = [-21.7779   10.5262   42.8304   50.2852   80.1044   99.9839  107.4387  127.3182  137.2580  221.7458];% lb = 10; si = 8*1024; ppmshift = 0; AutoPhaseAll = 1;% % expno = 340:344; expno = 248;% ExpNam = {'20211217_POPCGM3'};% expno = 43;% basl = [0.01 .14 .4 .6 .65 .99];% lb = 20; si = 8*1024; ppmshift = 0;% ExpNam = {'qdor_hex10mm_20210826'}; expno = 68:70;% td1start = 1;% basl = [0.01 .1   .9 .99];% lb = 10; si = 4*1024; ppmshift = 0;% AutoPhase = 1;% % ExpNam = {'210429_SC_Topgaard'}; expno = 10;% td1start = 1;% basl = [0.03 .12 .49 .53  .85 .97];% lb = 20; si = 2*1024; ppmshift = 0;% lb1 = 20; si1 = 512; ppmshift1 = 0;% AutoPhase = 0; pivot = 0.3794; phc0 = 105; phc1 = -120;% FindPeaks = 0; ll = fliplr([1512 1409 1208 1125 815 730 623 552 495])'; ul = fliplr([1571 1425 1261 1165 866 803 641 587 534])';% ExpNam = {'210422_SC_Topgaard'}; expno = 40;% td1start = 1;% AutoPhase = 0; pivot = 0.3745; phc0 = 110; phc1 = -120;% basl = [.03 .1 .85 .97]; lb = 20; si = 2*1024;%ExpNam = {'trteaxde_yeast'}; expno = 4;%ExpNam = {'MIC5_10mm_setup'}; expno = 142;%ExpNam = {'trteaxde_composite4'}; expno = 8;% ExpNam = {'trteaxde_composite7'}; expno = 4;% ExpNam = {'210408_Lecithin_Topgaard'}; expno = 21;% td1start = 8;% AutoPhase = 1;% basl = [.03 .15 .64 .7 .78 .97]; lb = 20; si = 2*1024;% ExpNam = {'CPMAS_4mm_setup'};% expno = 28;% basl = [0.01 .14 .4 .6 .65 .99];% lb = 20; si = 2*1024; ppmshift = 0;% ExpNam = {'CPMAS4mm_setup'};% expno = 41:54;% basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];% lb = 20;% si = 2*1024;% ppmshift = 0;% % % ExpNam = {'C10E4relax'};% expno = 27:40;% expno = [91:100 51:70 27:40];% expno = 63;% basl = [.02 .1 .14 .2 .37 .68 .72 .79 .86 .98];% lb = 2;% si = 32*1024;% ppmshift = 0;% ll = [%         3778%         7377%         8815%        10154%        11192%        22927%        26649%        27156%        27635];% ul = [       3828%         7425%         8869%        10372%        11249%        22978%        26863%        27209%        27685]; % ExpNam = {'qVAS_Starch'}; expno = 14; BiexpFitFlag = 0;% basl = [.05 .3 .7 .95];% ExpNam = {'DiffCR_setup'}; expno = [22 23 33 34];% basl = [.05 .2 .8 .95]; lb = 200; si = 16*1024;% ll = [8160 8700]'; ul = [8241 8800]';% ExpNam = {'AOToct2'}; expno = 6; expno = 23; expno = 22;% basl = [.03 .2 .75 .97]; lb = 5;si = 16*1024;% AutoPhase = 1;% ll = [8130 8198 8227]'; ul = [8134 8202 8231]';% ExpNam = {'AOToct3'}; expno = 4;% basl = [.03 .2 .75 .97]; lb = 5;si = 16*1024;% AutoPhase = 1;% ll = [8717 8784 8821]'; ll = ll - 5; ul = ll + 10;% ExpNam = {'Tissue_qVAS'}; expno = 3;% basl = [.03 .2 .75 .97]; lb = 5;si = 16*1024;% AutoPhase = 1;% ll = [8185 8201 8239]'; ll = ll - 5; ul = ll + 10;% ExpNam = {'AOToct5'}; expno = 4;% basl = [.03 .2 .75 .97]; lb = 5;si = 16*1024;% AutoPhase = 1;% ll = [7589 7818 8742  8793 8825]'; ll = ll - 5; ul = ll + 10;% ExpNam = {'AOToct6'}; expno = 18;% basl = [.03 .25 .8 .97]; lb = 5; si = 4*1024;% ll = [2702 2782 2829]'; ll = ll - 10; ul = ll + 20;% AutoPhase = 1;%ExpNam = {'AOToct_temp9'}; expno = 14:10:144; expno = [expno expno+1];%AutoPhase = 1; lb = 10;% % ExpNam = {'RandSampDR1R2'}; expno = [124 125];% td1start = 2; lb = 10;% ExpNam = {'AOToct_temp10'}; %expno = [124 125];% td1start = 1; lb = 10;%ExpNam = {'AOToct8'};%td1start = 1; lb = 10;%ExpNam = {'AOToct9'};%ExpNam = {'C14E5_6'};%ExpNam = {'AOToct_Eq6'};% ExpNam = {'AOToct_Eq7'};% ExpNam = {'CK_170306'}; expno = 82;% lb = 1;cd(ExpNam{1})if exist('expno') == 0    GetExpnosendfor nexp = 1:length(expno)    ConvertAcqus = 'Y';    ConvertProcs = 'Y';    MakeTextfile = 'N';    if exist([num2str(expno(nexp)) '/NMRacqus.mat']) == 0        ConvertAcqus = 'Y';    end    res = fExpnoInfo2(ConvertAcqus,MakeTextfile,ConvertProcs,expno(nexp));    eval(['load ' num2str(expno(nexp)) '/NMRacqus'])    if any(strcmp(NMRacqus.pulprog,{'DT_rpdlf','DT_cprpdlf','DT_cpvd1','DT_T1ir','DT_seT1ir','DT_T2se','DT_inxt1','DT_cpxt1','DT_inxt1rho','DT_cpxt1rho'}) == 1)        Spec2Dtd1        PeakPick        if any(strcmp(NMRacqus.pulprog,{'DT_cpvd1','DT_T1ir','DT_seT1ir','DT_T2se','DT_inxt1','DT_cpxt1'}) == 1)            Xdat = NMRacqus.vd;        elseif any(strcmp(NMRacqus.pulprog,{'DT_inxt1rho','DT_cpxt1rho'}) == 1)            Xdat = 1e-6*NMRacqus.vp;        elseif any(strcmp(NMRacqus.pulprog,{'DT_rpdlf','DT_cprpdlf'}) == 1)            Xdat = 1e-6*NMRacqus.l1*4*NMRacqus.p32*(0:(NMRacqu2s.td-1))';        end        fitpoints = td1start:min([NMRacqu2s.td numel(Xdat)]);        %fitpoints = 1:NMRacqu2s.td;        PP.X = Xdat;        if any(strcmp(NMRacqus.pulprog,{'DT_cpvd1','DT_T1ir','DT_seT1ir'}) == 1)            T1Fit        elseif any(strcmp(NMRacqus.pulprog,{'DT_rpdlf','DT_cprpdlf'}) == 1)            GansmullerFit        else            ExpFit        end            fs = 20;        lw = 1;        %%        figure(2), clf        axes('position',[-.01 .15 1.02 .35],'FontSize',fs*.8)        plot(PP.ppm,PP.Ispec,'k','LineWidth',lw)        set(gca,'XDir','reverse','YTick',[],'LineWidth',1.5*lw,'Box','off','TickDir','out','Ycolor',[1 1 1])        axis('tight')        ylim = get(gca,'YLim');        ylim = .05*diff(ylim)*[-1 1] + ylim;        set(gca,'YLim',ylim)        xlabel(['\delta(' NMRacqus.nuc1 ') / ppm'],'FontSize',fs)        hold on        plot(PP.peakppm(PP.td1start,:),PP.Ipeak(PP.td1start,:),'bo','LineWidth',lw)        Iscale = .5*max(PP.Ipeak(PP.td1start,:))/min(PP.Ipeak(PP.td1start,:));        h1 = plot(PP.ppm,-1*ylim(1)+Iscale*PP.Ispec,'k','LineWidth',.5*lw);        set(h1,'Color',.75*[1 1 1])        plot(PP.peakppm(PP.td1start,:),-1*ylim(1)+Iscale*PP.Ipeak(PP.td1start,:),'bo','LineWidth',lw)        dleft = (1-.1)/Npeaks;        width = .9*dleft;        height = .3;        left = 1-width;        bottom = .6;        if Npeaks == 1, width = .8*1/2; end        for npeak = 1:Npeaks            axes('position',[left bottom width height],'FontSize',fs*.8)            semilogy(FitDat.Xin(:,npeak),FitDat.Yin(:,npeak)/FitDat.Y0(npeak),'bo')            hold on            semilogy(FitDat.Xin(:,npeak),FitDat.Yout(:,npeak)/FitDat.Y0(npeak),'k-','LineWidth',lw)            axis('tight')            ylim = get(gca,'YLim');            %ylim = .05*abs(diff(ylim))*[-1 1] + abs(ylim); ylim(1) = 0;            ylim = ylim(2)*[Imin 1.2];            xlim = get(gca,'XLim');            xlim = .05*diff(xlim)*[-1 1] + xlim;            set(gca,'XLim',xlim,'YLim',ylim,...                'TickLength',.02*[1 1],'TickDir','out','Box','off','YMinorTick','on','LineWidth',1.5*lw)            set(gca,'YTick',[1e-3 1e-2 1e-1 1])            title({[num2str(PP.peakppm(td1start,npeak),3) ' ppm'];...                [num2str(FitDat.R(npeak),3) ' s^-^1']},'FontSize',fs*.5)            if any(strcmp(NMRacqus.pulprog,{'DT_cpvd1','DT_T1ir','DT_seT1ir'}) == 1)                xlim = [min(PP.X)/2 max(PP.X)*2];                set(gca,'YLim',[-1.1 1.1],'YScale','lin','XLim',xlim,'XScale','log')                set(gca,'YTick',[-1 0 1])                set(gca,'XTick',[1e-3 1e-2 1e-1 1 10])                        elseif any(strcmp(NMRacqus.pulprog,{'DT_cpvd1'}) == 1)                xlim = [min(PP.X)/2 max(PP.X)*2];                set(gca,'YLim',[-0.1 1.1],'YScale','lin','XLim',xlim,'XScale','log')                set(gca,'YTick',[0 .5 1])                set(gca,'XTick',[1e-3 1e-2 1e-1 1 10 100])            elseif any(strcmp(NMRacqus.pulprog,{'DT_rpdlf','DT_cprpdlf'}) == 1)                xlim = [min(PP.X)/2 max(PP.X)*2];                set(gca,'YLim',[-0.4 1.1],'YScale','lin')                set(gca,'YTick',[0 .5 1])                title({[num2str(PP.peakppm(td1start,npeak),3) ' ppm'];...                    [num2str(FitDat.splitting(npeak),3) ' Hz']},'FontSize',fs*.5)            end            left = left-dleft;            if npeak == Npeaks                xlabel(' t / s')                ylabel('I / I_0')            end            if npeak < Npeaks                set(gca,'XTick',[],'YTick',[])            end        end        eval(['save ' num2str(expno(nexp)) '/RelaxDat PP FitDat'])        if MkReportFig            delete([num2str(expno(nexp)) '/ReportFig.*'])            aspect = 1.6;            set(gcf, 'PaperUnits','centimeters','PaperPosition', 2*8.3*[0 0 1 1/aspect],'PaperSize', 2*8.3*[1 1/aspect]);            eval(['print -dpdf -loose ' num2str(expno(nexp)) '/ReportFig'])        end        if SvSpecDataMat            Spectd1.I = Itd1;            Spectd1.ppm = ppm;            Spectd1.X = Xdat;            save([num2str(expno(nexp)) '/Spectd1Dat.mat'],'Spectd1')        end    endend