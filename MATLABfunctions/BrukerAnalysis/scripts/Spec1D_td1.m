clear allwd = cd;%DataDir = '/Users/daniel/NMRdata/AVII500/DT/';%DataDir = '/Users/daniel/NMRdata/AVII200/';%DataDir = '/opt/topspin2/data/DT/nmr';%DataDir = '/opt/topspin/data/DT/nmr';%DataDir = '/Users/daniel/Dropbox/NMRdata/AVII500';%DataDir = '/Users/daniel/Dropbox/NMRdata/AVII200/';%DataDir = '/Users/daniel/Dropbox/NMRdata/AVII500/Sarah';DataDir = '/Users/daniel/Dropbox/NMRdata/AV4_500/nmrsu';%ExpNam = {'isoDW_test'}; expno = 72;%ExpNam = {'isoDW'}; expno = 10;%ExpNam = {'isoaniso_test'}; %expno = 24;%ExpNam = {'BileSaltCylinder'}; %expno = 3;%basl = [.02 .1 .9 .98]; lb = 20; si = 4*1024;%ll = 1959; ul = 2307;% ExpNam = {'Yeast20120919'}; expno = 30+(7:-1:2);% basl = [.05 .2 .8 .95]; lb = 10; si = 8*1024;% ExpNam = {'qMASopt'}; expno = 40;% basl = [.02 .35 .65 .98]; lb = 10; si = 16*1024;%ExpNam = {'Spindiff'}; expno = 44;%basl = [.05 .2 .8 .95]; lb = 10; si = 1*1024;%ExpNam = {'Starch_DRcorr'}; expno = 13;%ExpNam = {'tbppgste_trtmte_test'}; %expno = 10;%ExpNam = {'Yeast_fexsy_31P'}; expno = 115;%ExpNam = {'Yeast_sedimenation_fexsy_170302'}; expno = 2:2700; expno = 1000;%ll = [1190 1230 1270 1311 1481]'; ul = [1225 1267 1301 1338 1601]';%ExpNam = {'CK_170306'}; expno = [113:115 118:124];%ExpNam = {'Sofia_FEXSY'}; expno = 20:420; %expno = 391;% ExpNam = {'Sofia_FEXSY_20171219'}; expno = 56; %expno = 391;% lb = 10; FIDeff = .8; %si = 16*1024;%ExpNam = {'MN_waveforms'}; expno = 5;% ExpNam = {'Marcus_May162018'};% lb = 50; FIDeff = .8; %si = 16*1024;%ExpNam = {'Sofia_20180919'}; %expno = 5;% ExpNam = {'Sofia_20180712'}; %expno = 2;% lb = 20; FIDeff = .8; si = 2*1024;% ll = [465   653   919]'; ul = [493         766        1229]';ExpNam = {'DIFF_AmpTest'}; expno = 23;lb = 20; FIDeff = .95; %si = 2*1024;%ll = [465   653   919]'; ul = [493         766        1229]';AutoPhase = 1;AutoPhaseAll = 0;CheckBasline = 0;FindPeaks = 1;CheckPeaks = 0;PlotInterm = 0;thresh = .05;td1start = 1;signal = 'area'; %signal = 'intensity';fs = 12; lw = 1;cd(DataDir)%GetExpnamsfor ndir = 1:numel(ExpNam)    ExpNam{ndir}    cd(ExpNam{ndir})    %expno = mdm_bruker_dir2expno(fullfile(DataDir,ExpNam{ndir}));    if exist('expno') == 0, expno = mdm_bruker_dir2expno(fullfile(DataDir,ExpNam{ndir})), end    for nexp = 1:length(expno)        ConvertAcqus = 'Y';    ConvertProcs = 'N';    MakeTextfile = 'N';        if exist([num2str(expno(nexp)) '/NMRacqus.mat']) == 0            ConvertAcqus = 'Y';        end        res = fExpnoInfo2(ConvertAcqus,MakeTextfile,ConvertProcs,expno(nexp));        data_path = fullfile(DataDir,ExpNam{ndir},num2str(expno(nexp)));        load(fullfile(data_path,'NMRacqus'))        if any(strcmp(NMRacqus.pulprog,{'diffSte','DT_pgste','DT_pgse','DT_dfpgste','DT_fexsydpgste',...                'DT_T1ir','DT_fexsy3','DT_qMASdt','DT_tbppgsteT1T2TM','DT_mgzse','SM_tbppgsteT1T2M'})) == 1            Spec2Dtd1%             %             figure(1), clf%             plot3(repmat((1:NMRprocs.si)',[1 NMRacqu2s.td]),repmat(1:NMRacqu2s.td,[NMRprocs.si 1]),Itd1,'k-')%             set(gca,'XDir','reverse','ZLim',.1*max(Itd1(:))*[-.1 1.1])%             return            PeakPick            %%            figure(1), clf            axes('position',[-.01 .13 1.02 .35])            h1 = plot(PP.ppm,PP.Ispec,'k','LineWidth',lw);            set(gca,'XDir','reverse','YTick',[],'LineWidth',lw,'Box','off','TickDir','out','Ycolor',[1 1 1],'FontSize',fs*.8)            axis('tight')            ylim = get(gca,'YLim');            ylim = .05*diff(ylim)*[-1 1] + ylim;            set(gca,'YLim',ylim)            hold on            h2 = plot(PP.ppm,-1*ylim(1)+50*PP.Ispec,'k','LineWidth',.5*lw);            set(h2,'Color',.75*[1 1 1])            set(gca,'Children',flipud(get(gca,'Children')))            plot(PP.peakppm(td1start,:),PP.Ipeak(td1start,:),'bo','LineWidth',lw)            plot(PP.ppm(PP.intlim),zeros(size(PP.intlim)),'r-','LineWidth',lw)            plot(PP.peakppm(td1start,:),-1*ylim(1)+50*PP.Ipeak(td1start,:),'bo','LineWidth',lw)            xlabel(['\delta(' NMRacqus.nuc1 ') / ppm'],'FontSize',fs)            dleft = (1-.1)/Npeaks;            width = .9*dleft;            height = .3;            left = 1-width;            bottom = .6;            if Npeaks == 1, width = .8*1/2; end            for npeak = 1:Npeaks                axes('position',[left bottom width height])                if strcmp(signal,'intensity')==1                    semilogy(1:td1,PP.Ipeak(:,npeak),'bo')                elseif strcmp(signal,'area')==1                    semilogy(1:td1,PP.Apeak(:,npeak),'ro')                end                hold on                axis('tight')                ylim = get(gca,'YLim');                %ylim = .05*abs(diff(ylim))*[-1 1] + abs(ylim); ylim(1) = 0;                ylim = ylim(2)*[1e-4 1.1];                xlim = get(gca,'XLim');                xlim = .05*diff(xlim)*[-1 1] + xlim;                set(gca,'XLim',xlim,'YLim',ylim,...                    'TickLength',.02*[1 1],'TickDir','out','Box','off','YMinorTick','on','LineWidth',lw,'FontSize',fs*.5)                %set(gca,'YTick',[1e-3 1e-2 1e-1 1])                %set(gca,'XTick',[1e7 1e8 1e9 1e10 1e11])                title({[num2str(PP.peakppm(td1start,npeak),3) ' ppm'];...                    },'FontSize',fs*.5)                left = left-dleft;                %set(gca,'XLim',xlim,'XScale','log')                if npeak < Npeaks                    set(gca,'XTickLabel',[],'YTickLabel',[])                end            end            eval(['save ' num2str(expno(nexp)) '/PeakDat PP'])            delete([num2str(expno(nexp)) '/ReportFig.*'])            aspect = 1.6;            set(gcf, 'PaperUnits','centimeters','PaperPosition', 2*8.3*[0 0 1 1/aspect],'PaperSize', 2*8.3*[1 1/aspect]);            eval(['print ' num2str(expno(nexp)) '/ReportFig -loose -dpdf'])            %%        end    end    cd ..end