clear allMkReportFig=1;fignam = 'hetcor_multi.tex';% data_path = '/Users/daniel/Dropbox/NMRdata/AV4_500/daniel/';% expnam = '20220922_CTADNAwet_edumbosdhetcor';% Imin = .02; Imax = .2; expno = -100+[201:208 210:215 217:225 227:231 233 236:242 244:247]; %13C% ppmmin = -5; ppmmax = 185; ppmmin1 = -1; ppmmax1 = 11;% expno = [201:208 210:215 217:225 227:231 233 236:242 244:247]; fignam = 'hetcor_multi_31P.tex'; %31P% Imin = .02; Imax = .8; % ppmmin = -20; ppmmax = 20;data_path = '/Users/daniel/Dropbox/NMRdata/AV4_500/daniel/';expnam = '20220223_POPCGM3AS';expno_in = [223 237 233 224 229 241];expno_cp = [226 238 234 227 230];Imin = .03; Imax = 1; % ppmmin = -5; ppmmax = 185; ppmmin1 = -1; ppmmax1 = 11;% expno = [220 239 235 221 231]; fignam = 'hetcor_multi_31P.tex'; %31P% Imin = .1; Imax = 1; % ppmmin = -9; ppmmax = 9;peakppmmin1 = 4.5; peakppmmax1 = 4.8;% data_path = '/Users/daniel/Dropbox/NMRdata/SNC/DNP';% expnam = '210510_SC_Topgaard';% Imin = .005; Imax = .25; expno = [10:18 20:23 25:48]; fignam = 'hetcor_multi.tex';% ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;% Imin = .15; Imax = 1; expno = [29:39]; fignam = 'hetcor_multi_sd.tex';% ppmmin = 5; ppmmax = 85; ppmmin1 = -3; ppmmax1 = 11;% Imin = .05; Imax = .35; expno = [40:48]; fignam = 'hetcor_multi_sd_long.tex';% ppmmin = 5; ppmmax = 85; ppmmin1 = -3; ppmmax1 = 11;% Imin = .05; Imax = .35; expno = [40:48]; fignam = 'hetcor_multi_sd_long_wide.tex';% ppmmin = 5; ppmmax = 195; ppmmin1 = -3; ppmmax1 = 11;% Imin = .005; Imax = .25; expno = [10:50]; fignam = 'hetcor_multi_expno.tex';% ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;% expnam = '210429_SC_Topgaard';% % Imin = .1; Imax = 1; expno = [8 6 5 7 9]; fignam = 'hetcor_5to9.tex';% Imin = .04; Imax = 1; expno = [11:17]; fignam = 'hetcor_11to17.tex';% ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;% data_path = '/Users/daniel/Dropbox/NMRdata/AV4_500/Simon/';% expnam = 'POPC_GM3_AS_hetcor';% Imin = .05; Imax = .5; expno = [58:64]; fignam = 'hetcor_58to64.tex';% Imin = .1; Imax = 1; expno = [67:73]; fignam = 'hetcor_67to73.tex';% ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;% data_path = '/Users/daniel/Dropbox/NMRdata/SNC/DNP';% expnam = '210422_SC_Topgaard';% Imin = .005; Imax = .12; expno = [49 41 50 51 57];% ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;aspect = 1.6;papersize = 2*8.3*[1 1/aspect];expno = expno_in;nexp = 1;spec_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'SpecDat.mat');load(spec_fn)ppm = Spec.ppm;ppm1 = Spec.ppm1;Iarray = zeros(size(Spec.I,1),size(Spec.I,2),numel(expno));for nexp = 1:length(expno)        spec_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'SpecDat.mat');    load(spec_fn)    Iarray(:,:,nexp) = Spec.I;    NMRacqus_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'NMRacqus.mat');    load(NMRacqus_fn)    d1_v(nexp) = NMRacqus.d1;    p15_v(nexp) = NMRacqus.p15;    d8_v(nexp) = NMRacqus.d8;    if any(strcmp(NMRacqus.pulprog,{'DT_hetcorin','DT_hetcorcp','DT_edumbohetcorcp','DT_edumbohetcorcpdr'}) == 1)        d8_v(nexp) = 0;    end    if any(strcmp(NMRacqus.pulprog,{'DT_hetcorin','DT_sdhetcorin'}) == 1)        p15_v(nexp) = NaN;    endendindat.Iarray = Iarray;indat.d8 = d8_v;expno = expno_cp;Iarray = zeros(size(Spec.I,1),size(Spec.I,2),numel(expno));for nexp = 1:length(expno)        spec_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'SpecDat.mat');    load(spec_fn)    Iarray(:,:,nexp) = Spec.I;    NMRacqus_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'NMRacqus.mat');    load(NMRacqus_fn)    d1_v(nexp) = NMRacqus.d1;    p15_v(nexp) = NMRacqus.p15;    d8_v(nexp) = NMRacqus.d8;    if any(strcmp(NMRacqus.pulprog,{'DT_hetcorin','DT_hetcorcp','DT_edumbohetcorcp','DT_edumbohetcorcpdr'}) == 1)        d8_v(nexp) = 0;    end    if any(strcmp(NMRacqus.pulprog,{'DT_hetcorin','DT_sdhetcorin'}) == 1)        p15_v(nexp) = NaN;    endendcpdat.Iarray = Iarray;cpdat.d8 = d8_v;if exist('ppmmin') == 0    ppmmin = min(ppm);    ppmmax = max(ppm);endif exist('ppmmin1') == 0    ppmmin1 = min(ppm1);    ppmmax1 = max(ppm1);end    maxI = max([indat.Iarray(:); cpdat.Iarray(:)]);minI = Imin*maxI;%%cpdat.peak1_Iproj = squeeze(max(cpdat.Iarray(:,find(ppm1>peakppmmin1&ppm1<peakppmmax1),:)/maxI,[],2));cpdat.Iproj = squeeze(max(cpdat.Iarray(:,find(ppm1>ppmmin1&ppm1<ppmmax1),:)/maxI,[],2));cpdat.Iproj1 = squeeze(max(cpdat.Iarray(find(ppm>ppmmin&ppm<ppmmax),:,:)/maxI,[],1));indat.peak1_Iproj = squeeze(max(indat.Iarray(:,find(ppm1>peakppmmin1&ppm1<peakppmmax1),:)/maxI,[],2));indat.Iproj = squeeze(max(indat.Iarray(:,find(ppm1>ppmmin1&ppm1<ppmmax1),:)/maxI,[],2));indat.Iproj1 = squeeze(max(indat.Iarray(find(ppm>ppmmin&ppm<ppmmax),:,:)/maxI,[],1));fs = 2*5;lw = 2*1;nexp = length(expno_in);bottom_cm = 1.5;dheight_cm = 2;papersize_cm = 2*[8.3 bottom_cm+dheight_cm*nexp];bottom = bottom_cm/papersize_cm(2);figure(1), clfaxes('position',[0 bottom 1 1-bottom],'LineWidth',lw,'FontSize',fs)for nexp = 1:numel(expno_cp)    h = plot(ppm,cpdat.Iproj(:,nexp) + (nexp-1));    set(h,'LineWidth',1*lw,'Color',[.7 .7 1])    hold onendfor nexp = 1:numel(expno_in)    h = plot(ppm,indat.Iproj(:,nexp) + (nexp-1));    set(h,'LineWidth',.75*lw,'Color',[1 .7 .7])endfor nexp = 1:numel(expno_cp)    h = plot(ppm,cpdat.peak1_Iproj(:,nexp) + (nexp-1));    set(h,'LineWidth',.5*lw,'Color',[0 0 1])endfor nexp = 1:numel(expno_in)    h = plot(ppm,indat.peak1_Iproj(:,nexp) + (nexp-1));    set(h,'LineWidth',.25*lw,'Color',[1 0 0])    TextString = [num2str(indat.d8(nexp)/1e-3,3) ' ms'];    text(ppmmax-1,nexp-1+.15,TextString,'HorizontalAlignment','left','VerticalAlignment','bottom','FontSize',fs)endfigure(1)hold offset(gca,'XDir','reverse','YTick',[],'LineWidth',1.5*lw,...    'Box','off','TickDir','out','Ycolor','none')Imin = -.2;Imax = max([numel(expno_in); numel(expno_in)]) + .01;axis([ppmmin ppmmax Imin Imax])xlabel(['\delta(' NMRacqus.nuc1 ') / ppm'])if MkReportFig    fig_fn = fullfile(data_path,expnam,'sdhetcor_wateredited.pdf');    set(gcf, 'PaperUnits','centimeters','PaperPosition', [0 0 papersize_cm],'PaperSize', papersize_cm);    set(gcf,'Render','painters')    print(fig_fn, '-dpdf', '-loose')endreturnfs = 12;lw = 1;for nexp = 1:length(expno)    I = Iarray(:,:,nexp);    Iplot = I; %Iplot(find(Iplot<minI)) = minI;    Iplot = Iplot/maxI;%        Iproj = max(I,[],2); Iproj = Iproj/max(Iproj(find(ppm>ppmmin&ppm<ppmmax)));%        Iproj1 = max(I,[],1); Iproj1 = Iproj1/max(Iproj1(find(ppm1>ppmmin1&ppm1<ppmmax1)));%     Iproj = max(I(:,find(ppm1>ppmmin1&ppm1<ppmmax1)),[],2); Iproj = Iproj/max(Iproj(find(ppm>ppmmin&ppm<ppmmax)));%     Iproj1 = max(I(find(ppm>ppmmin&ppm<ppmmax),:),[],1); Iproj1 = Iproj1/max(Iproj1(find(ppm1>ppmmin1&ppm1<ppmmax1)));    Iproj = max(Iplot(:,find(ppm1>ppmmin1&ppm1<ppmmax1)),[],2);    Iproj1 = max(Iplot(find(ppm>ppmmin&ppm<ppmmax),:),[],1);    figure(1), clf    axh_txt = axes('position',[0 0 1 1]);    txt_cell = {['expno = ' num2str(expno(nexp))];...        ['d1 = ' num2str(d1_v(nexp)) ' s'];...        ['p15 = ' sprintf('%4.0f',p15_v(nexp)) ' us'];...        ['d8 = ' num2str(d8_v(nexp)*1e3) ' ms']};    t = text(0,1,txt_cell);    t.FontSize = fs; t.Units = 'normalized'; t.HorizontalAlignment = 'left'; t.VerticalAlignment = 'top';    axis(axh_txt,'off')    axes('position',[.2 .15 .7 .65],'FontSize',fs)    contour(ppm,ppm1,Iplot',logspace(log10(Imin),log10(Imax),20),'k','LineWidth',.1)    axis([ppmmin ppmmax ppmmin1 ppmmax1 -.05 1.02])    view(0,90), shading('interp')    set(gca,'XDir','reverse','YDir','reverse','YAxisLocation','right','TickDir','out','Box','on')    grid('off')    set(gca,'LineWidth',lw)    xlabel('\delta(^1^3C) / ppm','FontSize',fs)    ylabel('\delta(^1H) / ppm','FontSize',fs)    colormap('hot')    hold on    plot3([ppmmax ppmmin ppmmin], [ppmmax1 ppmmax1 ppmmin1], [1 1 1],'k-','LineWidth',lw)    hold off    axes('position',[.2 .81 .7 .19])    plot(ppm,Iproj,'k','LineWidth',lw)    hold on    plot(ppm,peak1_Iproj(:,nexp),'Color',[.5 .5 1],'LineWidth',.5*lw)    set(gca,'XDir','reverse')    axis([ppmmin ppmmax Imax*[-.02 1.02]])    axis off    axes('position',[.0 .15 .2 .65])    plot(Iproj1,ppm1,'k','LineWidth',lw)    hold on     plot([0 0],[peakppmmin1 peakppmmax1],'Color',[.5 .5 1],'LineWidth',lw)    set(gca,'XDir','reverse','YDir','reverse')    axis([Imax*[-.02 1.02] ppmmin1 ppmmax1])    axis off    if MkReportFig        fig_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'ReportFig.pdf');%         delete(fig_fn)                set(gcf, 'PaperUnits','centimeters','PaperPosition', [0 0 papersize],'PaperSize', papersize);%         set(gcf,'color','none','inverthardcopy','off');        set(gcf,'Render','painters')        print(fig_fn, '-dpdf', '-loose')    endpause(1)end%%figtex_fn = fullfile(data_path,expnam,fignam);fidtex = fopen(figtex_fn,'w');fprintf(fidtex,'%s\r','\documentclass{article}');fprintf(fidtex,'%s\r','\usepackage{geometry,graphicx, epstopdf}');fprintf(fidtex,'%s\r',['\geometry{papersize={' num2str(papersize(1)) 'cm,' num2str(papersize(2)) 'cm}, scale=1}']);fprintf(fidtex,'%s\r','\usepackage[abs]{overpic}');fprintf(fidtex,'%s\r\r','\setlength\unitlength{1in}');fprintf(fidtex,'%s\r\r','\begin{document}');for nexp = 1:length(expno)    fig_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'ReportFig.pdf');    fprintf(fidtex,'%s\r','\begin{figure}');    fprintf(fidtex,'%s\r',['  \includegraphics[width=' num2str(papersize(1)) 'cm]{' fig_fn '}']);     fprintf(fidtex,'%s\r\r','\end{figure}');    fprintf(fidtex,'%s\r','\clearpage'); end    fprintf(fidtex,'%s\r','');fprintf(fidtex,'%s\r','\end{document}');fclose(fidtex);