clear allwd = cd;DataDir = '/Users/daniel/NMRdata/AVII500/DT/';cd(DataDir)ExpNam = 'AOT_1H2H';expno = 196; GridSamp = 1; Nb = 8; NDeltab = 13; WaterPeak = 2; %cub%expno = 171; GridSamp = 1; Nb = 8; NDeltab = 13; WaterPeak = 1; %lamexpno = 209; GridSamp = 1; Nb = 8; NDeltab = 13; WaterPeak = 3; %rev hexfor nexp = 1:length(expno)    eval(['load ' ExpNam '/' num2str(expno(nexp)) '/NMRacqus'])    eval(['load ' ExpNam '/' num2str(expno(nexp)) '/FitDat'])    fs = 20;    lw = 1;    figure(1), clf    axes('position',[-.02 .18 1.02 .3],'FontSize',fs*.8)    plot(PP.ppm,PP.Ispec,'k','LineWidth',lw)    set(gca,'XDir','reverse','YTick',[],'LineWidth',1.5*lw,'Box','off','TickDir','out','Ycolor',[1 1 1])    axis('tight')    ylim = get(gca,'YLim');    ylim = .05*diff(ylim)*[-1 1] + ylim;    set(gca,'YLim',ylim)    xlabel(['\delta(' NMRacqus.nuc1 ') / ppm'],'FontSize',fs)    hold on    plot(PP.peakppm(PP.td1start,:),PP.Ipeak(PP.td1start,:),'bo','LineWidth',lw)    dleft = .93/PP.Npeaks;    width = .9*dleft;    height = .3;    left = 1-width;    bottom = .55;    if PP.Npeaks == 1, width = .8*1/2; end    for npeak = 1:PP.Npeaks        axes('position',[left bottom width/2 height],'FontSize',fs*.5)        Xval = FitDat.Xin{npeak};        X2val = (3*cos(FitDat.Xin2{npeak}).^2 - 1)/2;        Yinval = FitDat.Yin{npeak}/FitDat.Y0(npeak);        Youtval = FitDat.Yout{npeak}/FitDat.Y0(npeak);        %figure(1), clf, plot(Xval,X2val,'o'), return        if GridSamp            Xval = reshape(Xval,Nb,NDeltab);            X2val = reshape(X2val,Nb,NDeltab);            Yinval = reshape(Yinval,Nb,NDeltab);            Youtval = reshape(Youtval,Nb,NDeltab);        end        semilogy(Xval,Yinval,'bo','LineWidth',lw)        hold on        semilogy(Xval,Youtval,'b-','LineWidth',lw)        axis('tight')        ylim = get(gca,'YLim');        %ylim = .05*abs(diff(ylim))*[-1 1] + abs(ylim); ylim(1) = 0;        %ylim = ylim(2)*[1e-2 1.2];        ylim = 1*[.9e-2 1.2];        %xlim = get(gca,'XLim');        %xlim = .05*diff(xlim)*[-1 1] + xlim;        xlim = max(max(Xval))*[-.1 1.1];        set(gca,'XLim',xlim,'YLim',ylim,'Box','off','YTick',[1e-3 1e-2 1e-1 1],...            'TickDir','out','TickLength',.03*[1 1],'Box','off','LineWidth',1.5*lw)        if npeak == PP.Npeaks            xlabel('b / m^-^2s','FontSize',fs*.6)            ylabel('I / I_0','FontSize',fs*.6)        end        if npeak < PP.Npeaks            set(gca,'XTickLabel',[],'YTickLabel',[])        end        Dpar = FitDat.Dpar(npeak);        Dperp = FitDat.Dperp(npeak);        title({[num2str(PP.peakppm(PP.td1start,npeak),3) ' ppm'];...            ['AD=' num2str(Dpar,2) ' m^2s^-^1'];...            [' RD=' num2str(Dperp,2) ' m^2s^-^1']},'FontSize',fs*.5)        axes('position',[left+width/2 bottom width/2 height],'FontSize',fs*.5)        semilogy(X2val',Yinval','bo','LineWidth',lw)        hold on        semilogy(X2val',Youtval','b-','LineWidth',lw)        xlim = [-.7 1.2];        set(gca,'XLim',xlim,'YLim',ylim,'Box','off','YTick',[1e-3 1e-2 1e-1 1],...            'TickDir','out','TickLength',.03*[1 1],'Box','off','LineWidth',1.5*lw)        set(gca,'YTickLabel',[])        if npeak == PP.Npeaks            xlabel('\Deltab','FontSize',fs*.6)        end        if npeak < PP.Npeaks            set(gca,'XTickLabel',[])        end        left = left-dleft;    end%%        npeak = WaterPeak;            Xval = FitDat.Xin{npeak};        X2val = (3*cos(FitDat.Xin2{npeak}).^2 - 1)/2;        Yinval = FitDat.Yin{npeak}/FitDat.Y0(npeak);        Youtval = FitDat.Yout{npeak}/FitDat.Y0(npeak);        %figure(1), clf, plot(Xval,X2val,'o'), return        if GridSamp            Xval = reshape(Xval,Nb,NDeltab);            X2val = reshape(X2val,Nb,NDeltab);            Yinval = reshape(Yinval,Nb,NDeltab);            Youtval = reshape(Youtval,Nb,NDeltab);        end                figure(2), clf        axes('position',[.15 .2 .4 .8])        l0 = plot3(Xval/1e9,X2val,log10(Yinval),'ko');        hold on                Diso = (Dpar+2*Dperp)/3        DeltaD = (Dpar-Dperp)/3/Diso                Emin = .01;        bmax = -log(Emin)/Diso;        NX = 80;        XlineX = bmax*linspace(0,1,NX);        X2lineX = Xval(:,1);        NX2 = 1 + 100*3;        XlineX2 = X2val(1,:);        X2lineX2 = linspace(-.5,1,NX2);        [XlineX,XlineX2] = ndgrid(XlineX,XlineX2);        [X2lineX,X2lineX2] = ndgrid(X2lineX,X2lineX2);        XlineE = fDiffVACSY2([1 Diso DeltaD],XlineX,XlineX2);        X2lineE = fDiffVACSY2([1 Diso DeltaD],X2lineX,X2lineX2);                l1 = plot3(XlineX/1e9,XlineX2,log10(XlineE),'k-');        l2 = plot3(X2lineX'/1e9,X2lineX2',log10(X2lineE)','k-');                Xsurf = bmax*linspace(0,1,NX);        X2surf = linspace(-.5,1,NX2);        [Xsurf,X2surf] = ndgrid(Xsurf,X2surf);        zetasurf = acos(sqrt((2*X2surf + 1)/3));        Ysurf = fDiffVACSY([1 FitDat.Dpar(npeak) FitDat.Dperp(npeak)],Xsurf,zetasurf);        Ysurf = real(Ysurf);                C = zeros(NX,NX2,3);        C(:,:,1) = .5*ones(NX,NX2);        C(:,:,2) = .5*ones(NX,NX2);        C(:,:,3) = .5*ones(NX,NX2);        fs = 30;        lw = 4;        h = surf(Xsurf/1e9,X2surf,log10(Ysurf),C);        set(h,'FaceLighting','phong','FaceColor','interp','FaceAlpha',.7,...              'AmbientStrength',0.3,'SpecularStrength',.5);        light('Position',[.5 -.5 1],'Style','infinite');        view(70,20)        shading interp                set([l0; l1; l2],'LineWidth',lw,'Color',[0 0 0]);        set([l0],'MarkerSize',2*lw,'MarkerFaceColor',[0 0 1],'Color',[0 0 1]);        axis tight        set(gca,'XLim',bmax/1e9*[-.02 1.02],'YLim',[-.52 1.02],'ZLim',log10(Emin)*[1.02 -.02])        grid off        set(gca,'TickDir','out','YTick',[-.5:.5:1],'ZTick',[-2 -1 0],'ZTickLabel',[0.01 0.1 1])        set(gca,'FontSize',fs,'LineWidth',lw,'TickLength',[.1 .05])                eval(['print -djpeg -opengl -r150  -loose ' ExpNam '/' num2str(expno(nexp)) '/DiffVACSYsurf' num2str(expno(nexp))])%%    %         delete([num2str(expno(nexp)) '/ReportFig.*'])%         eval(['print -depsc -loose ' num2str(expno(nexp)) '/ReportFig'])end