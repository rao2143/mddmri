clear allwd = cd;DataDir = '/opt/topspin2/data/DT/nmr';% DataDir = '/Users/daniel/NMRdata/AVII500/DT';% ExpNam = {'DTI_HHnerve'};%ExpNam = {'MIC5_10mm_setup'};%ExpNam = {'uFA_RARE'}; expno = 100;% ExpNam = {'isoaniso_test'};%ExpNam = {'DiffVACSY'}; expno = 92;ExpNam = {'qVAS_Starch'}; expno = 57;lb = 1e-4;si = 16;%DataDir = '/Users/daniel/NMRdata/AVII500/';%ExpNam = {'Norah'};fontsize = 15;cd(DataDir)%GetExpnamsfor ndir = 1:length(ExpNam)    ExpNam{ndir}    cd(ExpNam{ndir})    if exist('expno') == 0        GetExpnos    end    for nexp = 1:length(expno)        ConvertAcqus = 'Y';    ConvertProcs = 'N';    MakeTextfile = 'N';        if exist([num2str(expno(nexp)) '/NMRacqus.mat']) == 0            ConvertAcqus = 'Y';        end        res = fExpnoInfo2(ConvertAcqus,MakeTextfile,ConvertProcs,expno(nexp));        eval(['load ' num2str(expno(nexp)) '/NMRacqus'])        if strcmp('DT_cpmgoneshot',NMRacqus.pulprog) == 1            %%read time domain data and pick out relevant signal pointstd = 256*ceil(NMRacqus.td/256);dw = 1/NMRacqus.sw_h/2;t = 2*dw*(0:(td/2-1))';fid = fopen([num2str(expno(nexp)) '/fid'],'r','ieee-le');S = fread(fid,[2,td/2],'long')';S = S(:,1) + i*S(:,2);fclose(fid);%figure(1), clf, plot(1:td/2,real(S),1:td/2,imag(S)), returngrpdlycount = (1:(td/2))'/(td/2) - floor(td/2/2);zeroshiftfun = exp(-i*(NMRacqus.grpdly*2*pi*grpdlycount));zeroshiftfun = flipdim(zeroshiftfun,1);zeroshiftfun = fftshift(zeroshiftfun,1);S = fft(S,td/2,1);S = zeroshiftfun.*S;S = ifft(S,td/2,1);%figure(1), clf, plot(1:td/2,real(S),1:td/2,imag(S)), returnfigure(1), clf, plot(1:td/2,log10(abs(S))), return            Imax = abs(I);            Imax(nudim.i/2+(0:2),nudim.j/2+(0:2)) = 0;            Imax = max(reshape(Imax,numel(Imax),1));            figure(1), clf            colormap(hot(256));            clim = [0 1];            axes('position',[.15 .15 .85 .85],'FontSize',fontsize)            Iplot = abs(I)/Imax;            imagesc(r.i*1e3,r.j*1e3,Iplot',clim)            set(gca,'YDir','normal')            axis equal, axis tight            xlabel('read / mm'), ylabel('phase / mm')             delete([num2str(expno(nexp)) '/ReportFig*'])            delete([num2str(expno(nexp)) '/acqu*sconv'])            delete([num2str(expno(nexp)) '/*Dat.mat'])            delete([num2str(expno(nexp)) '/*.jpg'])            eval(['print ' num2str(expno(nexp)) '/ReportFig -loose -depsc'])        end    end    cd ..endcd(wd)