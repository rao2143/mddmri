clear allwd = cd;cd(['/Users/daniel/NMRdata/AVII500/DT/'])ExpNam = {'Efree4mm_setup'};expno = 26;basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];lb = 3;si = 8*1024;ppmshift = 0;ppmll = [13 22 26 29 31.5 52 60];ppmul = [15 24 28 31.5 36 55 68];minsplit = 80;lb1 = 20;si1 = 8*32;ppmshift1 = 0;Imin = .03; Imax = Imin*20;CheckBasline = 0;AutoPhase = 1;cd(ExpNam{1})for nexp = 1:length(expno)    Spec2Dtd1    %%    figure(1), clf, surf(real(Itd1)), shading('flat'), view(0,90)    colormap('jet')    %%        td1 = NMRacqu2s.td;    NR = NMRacqu3s.td;    dw1 = NMRacqus.l1*4*NMRacqus.p32*1e-6;    t1 = dw1*(0:(td1-1));    swh1 = 1/dw1;    nu1 = swh1*linspace(0, 1, si1); nu1 = nu1 - nu1(si1/2+1);        indx = 1 + (0:7)*td1;    figure(1), clf    plot(ppm,real(Itd1(:,indx)),'-')    axis tight    set(gca,'XDir','reverse')    %%    Inu2nu1vd = zeros(si,si1,NR);    for nR = 1:NR;        indx = (1:td1) + (nR-1)*td1;        I1 = real(Itd1(:,indx(1))); I1 = I1./max(I1);        Stemp = real(Itd1(:,indx));        Stemp(:,1) = 0.5*Stemp(:,1);        Itemp = fftshift(fft(Stemp,td1,2),2);        Itemp(:,td1/2+1) = Itemp(:,td1/2+2);        Stemp = ifft(ifftshift(Itemp,2),td1,2);        Stemp = real(Stemp);        [dummy,t1array] = ndgrid(1:si,t1);        lbfun1 = .5*(cos(-1/max(t1)*pi*t1array)+1);        Stemp = lbfun1.*Stemp;        Itemp = fftshift(fft(Stemp,si1,2),2);        %Itemp(:,si1/2+1) = Itemp(:,si1/2+2);        Itemp = real(Itemp);        Inu2nu1vd(:,:,nR) = Itemp;    end    %%    Imax = max(reshape(Inu2nu1vd,numel(Inu2nu1vd),1));    ax = [0 si1 0 si Imax*[-.1 1.1]];    for nR = 1:NR;        figure(1), clf, surf(real(Inu2nu1vd(:,:,nR)))        shading('flat'), view(-40,40)        axis(ax)        colormap('jet')        pause(1)    end%%    I = Itemp./max(max(Itemp(:,find(nu1>minsplit/2))));    if exist('ppmmin') == 0        ppmmin = min(ppm);        ppmmax = max(ppm);    end        axesleft = 0.15;    axeswidth = .85;    Nslices = length(ppmul);    subaxesdistance = axeswidth/Nslices;    subaxesseparation = .01;    subaxeswidth = subaxesdistance - subaxesseparation;    axeswidthppm = (ppmmax-ppmmin);    subaxeswidthppm = axeswidthppm*subaxeswidth/axeswidth;    fs = 20;    lw = 1;    figure(1), clf    axes('position',[axesleft .20 axeswidth .8],'FontSize',fs)    plot(ppm,I1,'k','LineWidth',lw)    set(gca,'XDir','reverse','YTick',[],'Box','off','TickDir','out')    set(gca,'LineWidth',3*lw)    xlabel('\delta(^1^3C) / ppm')    axis([ppmmin ppmmax -.2 3.2])    ylabel(['expno=' num2str(expno(nexp))],'FontSize',10)    hold on    ppmll = sort(ppmll);    ppmul = sort(ppmul);    for nslice = 1:Nslices            pos = min(find(ppm>ppmll(nslice))):min(find(ppm>ppmul(nslice)));            %plot(ppm(pos),I1(pos),'b-')            subaxesleft = subaxesseparation/2 +axesleft+(Nslices - nslice)*subaxesdistance;            subaxesleftppm = ppmmax - (subaxesleft-axesleft)*axeswidthppm/axeswidth;            plot([ppm(min(pos)) subaxesleftppm-subaxeswidthppm],[1 1.3],'k')            plot(ppm(min(pos))*[1 1],[1 .9],'k')            plot((subaxesleftppm-subaxeswidthppm)*[1 1],[1.3 1.5],'k')            plot([ppm(max(pos)) subaxesleftppm],[1 1.3],'k')            plot(ppm(max(pos))*[1 1],[1 .9],'k')            plot(subaxesleftppm*[1 1],[1.3 1.5],'k')            %return    end    hold off    for nslice = 1:Nslices        pos = min(find(ppm>ppmll(nslice))):min(find(ppm>ppmul(nslice)));        Islice2D = I(pos,:);        ppmslice = ppm(pos);        limit = abs(nu1(2) - nu1(1));        Islice1 = sum(Islice2D,1);        posnu2 = (si1/2+2):si1;        Islice11 = Islice1(posnu2);        peakpos = max(find(Islice1 == max(Islice11)));        splitting(nslice) = 2*nu1(peakpos);        Islice1all(nslice,:) = Islice1;        Islice2 = sum(Islice2D,2);        peakpos = find(Islice2 == max(Islice2));        peakposppm(nslice) = ppmslice(peakpos);        Imax = max(max(Islice2D(:,find(nu1>limit))));        if Imin>Imax            Imax = Imin*1.1;        end        subaxesleft = subaxesseparation/2+axesleft+(Nslices - nslice)*subaxesdistance;        figure(1)        axes('position',[subaxesleft .78 subaxeswidth-.01 .22])        plot(Islice1,nu1/1e3,'k')        set(gca,'XDir','reverse')        axis('tight')        axis('off')        if nslice == Nslices            axis('on')            ylabel('\nu_1 / kHz','Rotation',90,'FontSize',fs)            set(gca,'XTick',[])        end        axes('position',[subaxesleft .56 subaxeswidth .21])        contour(ppmslice,nu1/1e3,Islice2D',linspace(Imin,Imax,10),'k')        axis('tight')        axis([min(ppmslice) max(ppmslice) min(nu1/1e3) max(nu1/1e3) -Imax Imax])        axis('off')        view(0,90)        shading('flat')        set(gca,'XDir','reverse','ZLim',[-Imax Imax],'XTick',[],'YTick',[])        title([num2str(peakposppm(nslice),4) '  ' num2str(splitting(nslice),3) '   '],'FontSize',6)    end        %figure(1), clf, surf(I), view(0,90), shading('flat'), return    delete([num2str(expno(nexp)) '/ReportFig.*'])    eval(['print -depsc -loose ' num2str(expno(nexp)) '/ReportFig'])end