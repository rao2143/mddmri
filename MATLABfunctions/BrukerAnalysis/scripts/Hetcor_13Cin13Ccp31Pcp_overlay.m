clear allMkReportFig=1;fignam = 'hetcor_13Cin13Ccp31Pcp_multi.tex';data_path = '/Users/daniel/Dropbox/NMRdata/AV4_500/daniel/';expnam = '20220223_POPCGM3AS';expno = [237]; %13C INEPTImin1 = .01; Imax1 = 1; Imin2 = .01; Imax2 = 1; ppmmin1 = -5; ppmmax1 = 185;ppmmin2 = -9; ppmmax2 = 9;ppmmin3 = -1; ppmmax3 = 11; %1Hnexp = 1;expno1 = expno(nexp)+1;spec_fn = fullfile(data_path,expnam,num2str(expno1),'SpecDat.mat');load(spec_fn)I1 = Spec.I;ppm1 = Spec.ppm;ppm3 = Spec.ppm1;NMRacqus_fn = fullfile(data_path,expnam,num2str(expno1),'NMRacqus.mat');load(NMRacqus_fn)expno2 = expno1+2;spec_fn = fullfile(data_path,expnam,num2str(expno2),'SpecDat.mat');load(spec_fn)I2 = Spec.I;ppm2 = Spec.ppm;ppm3 = Spec.ppm1;NMRacqus_fn = fullfile(data_path,expnam,num2str(expno2),'NMRacqus.mat');NMRacqus2 = load(NMRacqus_fn); NMRacqus2 = NMRacqus2.NMRacqus;if NMRacqus2.mulexpno(1) ~= expno1    warning('mulexpno not consistent')end    I1array = zeros(size(I1,1),size(I1,2),numel(expno1));I2array = zeros(size(I2,1),size(I2,2),numel(expno2));for nexp = 1:length(expno)     expno1 = expno(nexp);    spec_fn = fullfile(data_path,expnam,num2str(expno1),'SpecDat.mat');    load(spec_fn)    I1array(:,:,nexp) = Spec.I;    NMRacqus_fn = fullfile(data_path,expnam,num2str(expno1),'NMRacqus.mat');    load(NMRacqus_fn)    d1_v(nexp) = NMRacqus.d1;    d8_v(nexp) = NMRacqus.d8;    p15_v(nexp) = NMRacqus.p15;    expno2 = NMRacqus.mulexpno(2);    NMRacqus_fn = fullfile(data_path,expnam,num2str(expno2),'NMRacqus.mat');    NMRacqus2 = load(NMRacqus_fn); NMRacqus2 = NMRacqus2.NMRacqus;    if NMRacqus2.mulexpno(1) ~= expno1        warning(['mulexpno not consistent' numstr(expno1) ' ~= ' numstr(NMRacqus2.mulexpno(1)) ])    end    spec_fn = fullfile(data_path,expnam,num2str(expno2),'SpecDat.mat');    load(spec_fn)    I2array(:,:,nexp) = Spec.I;endif exist('ppmmin1') == 0    ppmmin1 = min(ppm1);    ppmmax1 = max(ppm1);endif exist('ppmmin2') == 0    ppmmin2 = min(ppm2);    ppmmax2 = max(ppm2);endif exist('ppmmin3') == 0    ppmmin3 = min(ppm3);    ppmmax3 = max(ppm3);end    maxI1 = max(I1array(:));minI1 = Imin1*maxI1;maxI2 = max(I2array(:));minI2 = Imin2*maxI2;%%Iproj1 = squeeze(max(I1array(:,find(ppm3>ppmmin3&ppm3<ppmmax3),:)/maxI1,[],2));Iproj13 = squeeze(max(I1array(find(ppm1>ppmmin1&ppm1<ppmmax1),:,:)/maxI1,[],1));Iproj2 = squeeze(max(I2array(:,find(ppm3>ppmmin3&ppm3<ppmmax3),:)/maxI2,[],2));Iproj23 = squeeze(max(I2array(find(ppm2>ppmmin2&ppm2<ppmmax2),:,:)/maxI2,[],1));maxIproj1 = max(Iproj1,[],2);maxIproj13 = max(Iproj13,[],2);maxIproj2 = max(Iproj2,[],2);maxIproj23 = max(Iproj23,[],2);maxIproj3 = max([maxIproj13 maxIproj23],[],2);for nexp = 1:length(expno)    %%    fs = 8;    lw = 1;    aspect = 2*1.6;    papersize = 4*8.3*[1 1/aspect];    I1 = I1array(:,:,nexp);    Iplot1 = I1;    Iplot1 = Iplot1/maxI1;%     Iproj1 = max(Iplot1(:,find(ppm3>ppmmin3&ppm3<ppmmax3)),[],2);%     Iproj13 = max(Iplot1(find(ppm1>ppmmin1&ppm1<ppmmax1),:),[],1);       I2 = I2array(:,:,nexp);    Iplot2 = I2;    Iplot2 = Iplot2/maxI2;%     Iproj2 = max(Iplot2(:,find(ppm3>ppmmin3&ppm3<ppmmax3)),[],2);%     Iproj23 = max(Iplot2(find(ppm2>ppmmin2&ppm2<ppmmax2),:),[],1);    figure(1), clf    axh_txt = axes('position',[0 0 1 1]);    t = text(0,1,{['expno = ' num2str(expno(nexp))];...        ['d1 = ' num2str(d1_v(nexp)) ' s'];...        ['p15 = ' sprintf('%4.0f',p15_v(nexp)) ' us'];...        ['d8 = ' num2str(d8_v(nexp)*1e3) ' ms']});    t.FontSize = fs; t.Units = 'normalized'; t.HorizontalAlignment = 'left'; t.VerticalAlignment = 'top';    axis(axh_txt,'off')    left = .36;    bottom = .1;    width1 = .5;    width2 = .1;    gap12 = .01;    height = .65;        axh1 = axes('position',[left bottom width1 height]);    contour(axh1,ppm1,ppm3,Iplot1',logspace(log10(Imin1),log10(Imax1),20),'k','LineWidth',.1)    set(axh1,'XLim',[ppmmin1 ppmmax1],'YLim',[ppmmin3 ppmmax3])    axh2 = axes('position',[left+width1+gap12 bottom width2 height]);    contour(axh2,ppm2,ppm3,Iplot2',logspace(log10(Imin2),log10(Imax2),20),'b','LineWidth',.1)    set(axh2,'XLim',[ppmmin2 ppmmax2],'YLim',[ppmmin3 ppmmax3])    set([axh1; axh2],'XDir','reverse','YDir','reverse','YAxisLocation','right','TickDir','out','Box','on',...        'TickDir','out','LineWidth',lw,'FontSize',fs)    set(axh1,'TickLength',.005/max([width1*aspect height])*[1 1],'YTickLabel',[])    set(axh2,'TickLength',.005/max([width2*aspect height])*[1 1])    xlabel(axh1,'\delta(^1^3C) / ppm','FontSize',fs)    xlabel(axh2,'\delta(^3^1P) / ppm','FontSize',fs)    ylabel(axh2,'\delta(^1H) / ppm','FontSize',fs)    axh11 = axes('position',[left bottom+height width1 1-bottom-height]);    plot(axh11,ppm1,maxIproj1,'Color',.9*[1 1 1],'LineWidth',2*lw)    hold on    plot(axh11,ppm1,Iproj1(:,nexp),'k','LineWidth',lw)    set(axh11,'XDir','reverse','Xlim',[ppmmin1 ppmmax1],'YLim',Imax1*[-.1 1.02])    axis off    axh13 = axes('position',[0 bottom left height]);    plot(axh13,maxIproj3,ppm3,'Color',.9*[1 1 1],'LineWidth',2*lw)    hold on    plot(axh13,Iproj13(:,nexp),ppm3,'k','LineWidth',lw)    plot(axh13,Iproj23(:,nexp),ppm3,'b','LineWidth',.75*lw)    set(axh13,'XDir','reverse','YDir','reverse','Xlim',Imax1*[-.01 1.02],'YLim',[ppmmin3 ppmmax3])    axis off        axh22 = axes('position',[left+width1+gap12 bottom+height width2 1-bottom-height]);    plot(axh22,ppm2,maxIproj2,'Color',[.9 .9 1],'LineWidth',2*lw)    hold on    plot(axh22,ppm2,Iproj2(:,nexp),'b','LineWidth',lw)    set(axh22,'XDir','reverse','Xlim',[ppmmin2 ppmmax2],'YLim',Imax2*[-.1 1.02])    axis off    if MkReportFig        fig_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'ReportFig.pdf');%         delete(fig_fn)                set(gcf, 'PaperUnits','centimeters','PaperPosition', [0 0 papersize],'PaperSize', papersize);        print(fig_fn, '-dpdf', '-loose')    endpause(1)end%%figtex_fn = fullfile(data_path,expnam,fignam);fidtex = fopen(figtex_fn,'w');fprintf(fidtex,'%s\r','\documentclass{article}');fprintf(fidtex,'%s\r','\usepackage{geometry,graphicx, epstopdf}');fprintf(fidtex,'%s\r',['\geometry{papersize={' num2str(papersize(1)) 'cm,' num2str(papersize(2)) 'cm}, scale=1}']);fprintf(fidtex,'%s\r','\usepackage[abs]{overpic}');fprintf(fidtex,'%s\r\r','\setlength\unitlength{1in}');fprintf(fidtex,'%s\r\r','\begin{document}');for nexp = 1:length(expno)    fig_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'ReportFig.pdf');    fprintf(fidtex,'%s\r','\begin{figure}');    fprintf(fidtex,'%s\r',['  \includegraphics[width=' num2str(papersize(1)) 'cm]{' fig_fn '}']);     fprintf(fidtex,'%s\r\r','\end{figure}');    fprintf(fidtex,'%s\r','\clearpage'); end    fprintf(fidtex,'%s\r','');fprintf(fidtex,'%s\r','\end{document}');fclose(fidtex);