clear allwd = cd;MkReportFig = 1;SvSpecDataMat = 1;%cd(['/Users/daniel/NMRdata/AVII500/DT/'])% ExpNam = {'CPMAS4mm_setup'};% expno = 37:38;% basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];% lb = 20;% si = 2*1024;% ppmshift = 0;% ppmll = [13 22 26 29 31.5 52 60];% ppmul = [15 24 28 31.5 36 55 68];% minsplit = 80;% lb1 = 20;% si1 = 2*32;% ppmshift1 = 0;% % ExpNam = {'C10E4relax'};% expno = 25;% basl = [.02 .1 .14 .2 .37 .68 .72 .79 .86 .98];% lb = 2;% si = 32*1024;% ppmshift = 0;% ppmll = [14 22.5 26 29.5 32 60.5 70 71 72];% ppmul = [15 23.5 27 30.5 33 61.5 71 72 73];% minsplit = 80;% lb1 = 20;% si1 = 2*32;% ppmshift1 = 0;% ExpNam = {'Efree4mm_setup'};% expno = 8;% basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];% lb = 20;% si = 2*1024;% ppmshift = 0;% ppmll = [13 22 26 29 31.5 52 60];% ppmul = [15 24 28 31.5 36 55 68];% minsplit = 80;% lb1 = 20;% si1 = 2*32;% ppmshift1 = 0;% Imin = .05; Imax = Imin*20;% cd(['/Users/daniel/NMRdata/AVII500/Dat/'])% ExpNam = {'C12E5_RPDLF'};% expno = 10;% basl = [.02 .16 .4 .65 .82 .98];% lb = 20;% si = 4*1024;% ppmshift = 14.2 - 13.37;% ppmll = [13 22 26 29 31.5 60 69];% ppmul = [15 24 27 31 33.5 62 74];% minsplit = 80;% lb1 = 20;% si1 = 2*32;% ppmshift1 = 0;% Imin = .05; Imax = Imin*20;% cd(['/Users/daniel/Dropbox/NMRdata/AV4_500/daniel/'])% ExpNam = {'CPMAS_4mm_setup'};% lb = 20; si = 4*1024; ppmshift = 0;% ppmll = [13 21 53 127];% ppmul = [15 36 72 132];% minsplit = 200; % lb1 = 20; si1 = 2*32; ppmshift1 = 0;% Imin = .05; Imax = Imin*20;% % expno = 46:47; basl = [0.01 .08 .5 .8 .9 .99];% expno = 25:26; basl = [0.01 .14 .4 .6 .65 .99];% % cd(['/Users/daniel/Dropbox/NMRdata/AV4_500/daniel/'])% cd(['/opt/nmrdata/daniel'])% lb = 10; si = 8*1024; ppmshift = 0;% ppmll = [11 21 51 102  128];% ppmul = [15 42 80 105 136];% ppmll = [11.0 13.7 22.2 24.7 26.2 27.0 28.8 31.8 33.7 36.3 39.2 51.8 53.4 59.4 61.1 62.8 65.2 66.0 66.7 69.5 72.7 74.2 78.6 100.0 102.7 129.3 133.5];% ppmul = [11.6 14.3 23.3 25.6 26.8 28.5 31.6 33.3 34.9 36.9 40.1 53.0 54.9 60.9 61.7 64.2 65.8 66.6 69.0 72.4 73.5 76.1 79.4 100.6 103.9 130.7 134.1];% ppmll = [11.0 13.5 22.0 24.5 36.3 39.2 51.8 53.4 59.0 61.1 62.5 65.2 74.2 78.6 100.0 102.5 129.1 133.5];% ppmul = [11.6 14.5 23.4 34.9 36.9 40.1 53.0 54.9 60.9 61.7 64.4 73.7 76.1 79.4 100.6 103.9 130.7 134.1];% ppmll = [11  98 124 165 206];% ppmul = [80 106 138 180 219];% minsplit = 200; % lb1 = 10; si1 = 64; ppmshift1 = 0;% Imin = .03; Imax = Imin*20;% % basl = [0.01 .14 .27 .3 .42 .5 .53 .61 .65 .99];% %baslppm = [-21.7779   10.5262   42.8304   50.2852   80.1044   99.9839  107.4387  127.3182  137.2580  221.7458];% baslppm = [-21.7779   10.5262   42.8304   50.2852   80.1044  85 97 99.9839  107.4387  127.3182  137.2580  165 180 207 217 221.7458];% % ExpNam = {'20220110_POPCGM3'};% % expno = [26 36 51 52 74:77 108:109 122:124 156:158 212:214 241:243 274:276 306:308]; expno = 306;% % ExpNam = {'20220223_POPCGM3AS'};% % expno = [15:17 65:67 102:104 125:126 141:143 164 166 168 170]; %expno = 170;% ExpNam = {'20220509_POPCGM3'}; DataDir = '/Users/daniel/Dropbox/NMRdata/AV4_500/jenny';ExpNam = {'yeastlipids'};lb = 10; si = 8*1024; ppmshift = 0;lb1 = 10; si1 = 64; ppmshift1 = 0;expno = [8 18 28 38]; %expno = 28;baslppm = [-20 7 80 120 135 145];minsplit = 100; ppmll = [7 43  120];ppmul = [40 76  130];Imin = .03; Imax = Imin*20;cd(DataDir);CheckBasline = 0;AutoPhase = 1;PlotInterm = 0;cd(ExpNam{1})if exist('expno') == 0    GetExpnosendfor nexp = 1:length(expno)    ConvertAcqus = 'Y';    ConvertProcs = 'Y';    MakeTextfile = 'N';    if exist([num2str(expno(nexp)) '/NMRacqus.mat']) == 0        ConvertAcqus = 'Y';    end    res = fExpnoInfo2(ConvertAcqus,MakeTextfile,ConvertProcs,expno(nexp));    eval(['load ' num2str(expno(nexp)) '/NMRacqus'])        if any(strcmp(NMRacqus.pulprog,{'DT_rpdlf','DT_cprpdlf'}) == 1)        Spec2Dtd1         dw1 = NMRacqus.l1*4*NMRacqus.p32*1e-6;        t1 = dw1*(0:(td1-1));        swh1 = 1/dw1;        nu1 = swh1*linspace(0, 1, si1); nu1 = nu1 - nu1(si1/2+1);    %     figure(1), clf    %     surf(real(Itd1))    %     view(0,90)    %     colormap('jet')    %     shading flat    %     caxis(.2*max(max(real(Itd1)))*[-1 1])    %     dat.S1 = real(Itd1(1709,:))';    %     dat.S2 = real(Itd1(1367,:))';    %     dat.S3 = real(Itd1(790,:))';    %     dat.t1 = t1';    %     figure(2), clf    %     plot(t1,dat.S1)    %     save /Users/daniel/Desktop/RPDLFdat dat    %     return    %         I1 = real(I); I1 = I1./max(I1);        Stemp = real(Itd1);        Stemp(:,1) = 0.5*Stemp(:,1);        if (0) % Reduces the spike in the center of F1 but distorts projection on F2            Itemp = fftshift(fft(Stemp,td1,2),2);            Itemp(:,td1/2+1) = Itemp(:,td1/2+2);            Stemp = ifft(ifftshift(Itemp,2),td1,2);            Stemp = real(Stemp);        end        [dummy,t1array] = ndgrid(1:si,t1);        lbfun1 = .5*(cos(-1/max(t1)*pi*t1array)+1);        Stemp = lbfun1.*Stemp;        Itemp = fftshift(fft(Stemp,si1,2),2);        %Itemp(:,si1/2+1) = Itemp(:,si1/2+2);        Itemp = real(Itemp);        %I = Itemp./max(max(Itemp(:,find(nu1>minsplit/2))));        I = Itemp;        maxI = max(max(I(:,nu1>minsplit/2)));        stdnoise = std(I(baslpoints,:),0,'all');        if exist('ppmmin') == 0            ppmmin = min(ppm);            ppmmax = max(ppm);        end%%        axesleft = 0.05;        axeswidth = 0.95;        Nslices = length(ppmul);        ppmperslice = ppmul-ppmll;        ppmtot = sum(ppmperslice);                subaxesdistance = ppmperslice/ppmtot*axeswidth;        subaxesseparation = .0;        subaxeswidth = subaxesdistance - subaxesseparation;%         subaxesleft = subaxesseparation/2+axesleft+[0 cumsum(subaxesdistance(1:(Nslices-1)))];        subaxesleft = subaxesseparation/2+axesleft+axeswidth - [cumsum(subaxesdistance)];                axeswidthppm = (ppmmax-ppmmin);        subaxeswidthppm = axeswidthppm*subaxeswidth/axeswidth;        fs = 8;        lw = 0.5;        figure(1), clf        axes('position',[axesleft .1 axeswidth .9],'FontSize',fs)        plot(ppm,I1,'k','LineWidth',lw)    %     hold on    %     Iproj = sum(I,2);    %     plot(ppm,.1+Iproj/max(Iproj),'r','LineWidth',.5*lw)            set(gca,'XDir','reverse','YTick',[],'Box','off','TickDir','out','YAxisLocation','right','FontSize',fs)        set(gca,'LineWidth',lw)        xlabel('\delta(^1^3C) / ppm','FontSize',fs)        axis([ppmmin ppmmax -.2 3.2])%         ylabel(['expno=' num2str(expno(nexp))],'FontSize',10)        hold on        ppmll = sort(ppmll);        ppmul = sort(ppmul);        for nslice = 1:Nslices                pos = min(find(ppm>ppmll(nslice))):min(find(ppm>ppmul(nslice)));                %plot(ppm(pos),I1(pos),'b-')                subaxesleftppm = ppmmax - (subaxesleft(nslice)-axesleft)*axeswidthppm/axeswidth;                plot([ppm(min(pos)) subaxesleftppm-subaxeswidthppm(nslice)],[1 1.3],'k')                plot(ppm(min(pos))*[1 1],[1 .9],'k')                plot((subaxesleftppm-subaxeswidthppm(nslice))*[1 1],[1.3 1.5],'k')                plot([ppm(max(pos)) subaxesleftppm],[1 1.3],'k')                plot(ppm(max(pos))*[1 1],[1 .9],'k')                plot(subaxesleftppm*[1 1],[1.3 1.5],'k')                %return        end        hold off        for nslice = 1:Nslices            pos = min(find(ppm>ppmll(nslice))):min(find(ppm>ppmul(nslice)));            Islice2D = I(pos,:);            ppmslice = ppm(pos);            limit = abs(nu1(2) - nu1(1));            Islice1 = sum(Islice2D,1);            posnu2 = (si1/2+2):si1;            Islice11 = Islice1(posnu2);            peakpos = max(find(Islice1 == max(Islice11)));            splitting(nslice) = 2*nu1(peakpos);            Islice1all(nslice,:) = Islice1;            Islice2 = sum(Islice2D,2);            peakpos = find(Islice2 == max(Islice2));            peakposppm(nslice) = ppmslice(peakpos);            Imax = max(max(Islice2D(:,find(nu1>limit))));            if Imin>Imax                Imax = Imin*1.1;            end                        figure(1)%             axes('position',[subaxesleft(nslice) .78 subaxeswidth(nslice) .22])%             plot(Islice1,nu1/1e3,'k')%             set(gca,'XDir','reverse')%             axis('tight')%             axis('off')%             if nslice == Nslices%                 axis('on')%                 ylabel('\nu_1 / kHz','Rotation',90,'FontSize',fs)%                 set(gca,'XTick',[])%             end            axes('position',[subaxesleft(nslice) .5 subaxeswidth(nslice) .45])            contour(ppmslice,nu1/1e3,Islice2D',logspace(log10(3*stdnoise),log10(maxI),10),'k')            axis('tight')            axis([min(ppmslice) max(ppmslice) min(nu1/1e3) max(nu1/1e3) -Imax Imax])%             axis('off')            view(0,90)            shading('flat')%             set(gca,'XDir','reverse','ZLim',maxI*[-1 1],'XTick',[],'YTick',[])            set(gca,'XDir','reverse','ZLim',maxI*[-1 1],'YTick',[],'XAxisLocation','top','TickDir','out','FontSize',fs)%             title([num2str(peakposppm(nslice),4) '  ' num2str(splitting(nslice),3) '   '],'FontSize',6)            if nslice == Nslices                ylabel('\nu_1 / kHz','Rotation',90,'FontSize',fs)                set(gca,'YTick',-3:3)            end        end%%        %figure(1), clf, surf(I), view(0,90), shading('flat'), return        if MkReportFig            delete([num2str(expno(nexp)) '/ReportFig.*'])            aspect = 1.6;            set(gcf, 'PaperUnits','centimeters','PaperPosition', 2*8.3*[0 0 1 1/aspect],'PaperSize', 2*8.3*[1 1/aspect]);            eval(['print -dpdf -loose ' num2str(expno(nexp)) '/ReportFig'])        end        if SvSpecDataMat            Spec.I = I;            Spec.ppm = ppm;            Spec.nu1 = nu1;            save([num2str(expno(nexp)) '/SpecDat.mat'],'Spec')        end    endend