clear allwd = cd;CheckBasline = 0;AutoPhase = 1;PlotInterm = 0;MkReportFig = 1;SvSpecDataMat = 1;% cd(['/opt/nmrdata/daniel'])cd('/Users/daniel/Dropbox/NMRdata/Faellanden')% cd(['/Users/daniel/Dropbox/NMRdata/AV4_500/daniel/'])ExpNam = {'ZHAA03_dTopgaard_210322_SC_MariaG_20221117'};expno = [200:207 300:306]; expno = [300:306]; expno = 206;ExpNam = {'ZHAA03_dTopgaard_210322_SC_MariaG_20221205'};expno = [300:307];lb1 = 50; si1 = 256; ppmshift1 = 0;lb = 50; si = 8*1024; ppmshift = 0;% AutoPhase = 1; phc0 = 180; phc1 = 0; pivotppm = 30; baslppm = [-80 0 220 240 270 290]; NPolyCoeff = 0;% expno = 403;% lb1 = 5; si1 = 256; ppmshift1 = 0;% lb = 5; si = 16*1024; ppmshift = 0;% % AutoPhase = 1; phc0 = 180; phc1 = 0; pivotppm = 30; % baslppm = [0 10 70 125 132 140]; NPolyCoeff = 0;% Imin = 0.017; Imax = 1;% ExpNam = {'20220922_CTADNAwet_edumbosdhetcor'}; % expno = [201:208 210:215 217:225 227:231 233 236:242 244:247]; %31P% % expno = 210% AutoPhase = 0; pivotppm = 00; phc0 = 85; phc1 = -200;% baslppm = [-230 -130 -110 -75 -50 -20 20 50 75 110 130 230]; NPolyCoeff = 3;% lb = 100; si = 8*1024;% lb1 = 100; si1 = 256;% Imin = .05; Imax = 1;% expno = -100+[201:208 210:215 217:225 227:231 233 236:242 244:247]; %13C% % expno = 104;% AutoPhase = 0; pivotppm = 30; phc0 = 20; phc1 = -50;% baslppm = [-20 0 200 220]; NPolyCoeff = 0;% ExpNam = {'20220907_CTADNAdry_edumbosdhetcor'}; % expno = [201:205 211:216]; %31P% AutoPhase = 0; pivotppm = 00; phc0 = 85; phc1 = -200;% baslppm = [-230 -130 -110 -75 -50 -20 20 50 75 110 130 230]; NPolyCoeff = 3;% lb = 100; si = 8*1024;% lb1 = 100; si1 = 256;% Imin = .05; Imax = 1;% expno = -100+[201:205 211:216]; %13C% AutoPhase = 0; pivotppm = 30; phc0 = 20; phc1 = -50;% baslppm = [-20 0 200 220]; NPolyCoeff = 0;% ExpNam = {'20220905_DPPC_edumbosdhetcor'}; % expno = [201:209 211:226 228:232 234:238]; %31P% AutoPhase = 0; pivotppm = 00; phc0 = 85; phc1 = -200;% baslppm = [-230 -130 -110 -75 -50 -20 20 50 75 110 130 230]; NPolyCoeff = 3;% lb = 100; si = 8*1024;% lb1 = 100; si1 = 256;% Imin = .05; Imax = 1;% expno = -100+[201:209 211:226 228:232 234:238]; %13C% %expno = 106;% AutoPhase = 0; pivotppm = 33; phc0 = 20; phc1 = -50;% baslppm = [-20 0 200 220]; NPolyCoeff = 0;% % ExpNam = {'20220110_POPCGM3'};% % expno = [32 35 142:143 173:174 229:230 291:292]; %expno = 291:292;% %basl = [0.01 .14 .27 .3 .42 .5 .53 .61 .65 .99];% lb = 10; si = 8*1024; ppmshift = 0;% lb1 = 40; si1 = 256; ppmshift1 = 0;% FIDeff = 1;% Imin = .01; Imax = 1;% baslppm = [-21.7779   10.5262   42.8304   50.2852   80.1044  85 97 99.9839  107.4387  127.3182  137.2580  165 180 207 217 221.7458];% ExpNam = {'20220223_POPCGM3AS'}; % % expno = [33 34 37 39 41 43 45:48 50 84:86 121:123 160:162 177 186:191 203:212 223:224 226:227 229:230 233:234 237:238 241];% expno = [223:224 226:227 229:230 233:234 237:238 241]; %expno = 241;% lb1 = 40; si1 = 256; ppmshift1 = 0;% % lb = 20; si = 8*1024; ppmshift = 0;% % AutoPhase = 0; phc0 = -30; phc1 = -25; pivotppm = 30; % % baslppm = [-15 0 145 165 190 205]; NPolyCoeff = 0;% lb = 50; si = 8*1024; ppmshift = 0;% AutoPhase = 0; phc0 = 30; phc1 = 0; pivotppm = 0; % baslppm = [-150 -50 50 150]; NPolyCoeff = 0;% expno = [218 220 221 231 235 239]; %expno = 231; %31P% ExpNam = {'20220509_POPCGM3'}; % expno = [11 14 17 20 23 27 31 35 39 43 47 51 55:2:67]; %31P% lb = 50; baslppm = [-230 -50 50 230];% cd(['/Users/daniel/Dropbox/NMRdata/SNC/DNP'])% ExpNam = {'210510_SC_Topgaard'};% basl = [0.03 .15 .47 .53  .88 .97];% lb = 50; si = 2*1024; ppmshift = 0;% lb1 = 50; si1 = 1024; ppmshift1 = 0;% AutoPhase = 0; pivot = 0.3779; phc0 = 115; phc1 = -150;% expno = [28]; Imin = .1; Imax = 1; expno = [10:50];% cd(['/Users/daniel/Dropbox/NMRdata/SNC/DNP'])% ExpNam = {'210429_SC_Topgaard'};% basl = [0.03 .12 .49 .53  .85 .97];% lb = 20; si = 2*1024; ppmshift = 0;% lb1 = 20; si1 = 512; ppmshift1 = 0;% pivot = 0.3794; phc0 = 105; phc1 = -120;% expno = [11]; Imin = .1; Imax = 1; expno = [5:9 11:18];% ppmmin = 0; ppmmax = 200; ppmmin1 = -2; ppmmax1 = 12;% cd(['/Users/daniel/Dropbox/NMRdata/AV4_500/Simon/'])% ExpNam = {'POPC_GM3_AS_hetcor'};% basl = [0.02 .2 .8 .98];% lb = 100; si = 2*1024; ppmshift = 0;% lb1 = 100; si1 = 512; ppmshift1 = 0;% pivot = 0.3442; phc0 = -33.1041; phc1 = -89.5894;% expno = [73]; Imin = .1; Imax = 1; expno = [58:64 67:73];% cd(['/Users/daniel/Dropbox/NMRdata/SNC/DNP'])% ExpNam = {'210422_SC_Topgaard'};% basl = [0.02 .1 .45 .53 .67 .72 .85 .98];% lb = 20; si = 2*1024; ppmshift = 0;% lb1 = 20; si1 = 512; ppmshift1 = 0;% expno = [57]; Imin = .01; Imax = 1; expno = [49 41 50 51 57];% ppmmin = 0; ppmmax = 200; ppmmin1 = -2; ppmmax1 = 12;% cd(['/Users/daniel/Dropbox/NMRdata/SNC/DNP'])% ExpNam = {'210408_Lecithin_Topgaard'};% basl = [0.02 .2 .65 .7 .8 .98];% lb = 50; si = 2*1024; ppmshift = 0;% lb1 = 50; si1 = 512; ppmshift1 = 1.2 - (-7.194);% expno = [17:20]; Imin = .1; Imax = 1;% ppmmin = 0; ppmmax = 200; ppmmin1 = -2; ppmmax1 = 12;% cd(['/Users/daniel/Dropbox/NMRdata/AV4_500/daniel/'])% ExpNam = {'CPMAS_4mm_setup'};% basl = [0.01 .08 .5 .8 .9 .99];% lb = 10; si = 4*1024; ppmshift = 0;% lb1 = 10; si1 = 512; ppmshift1 = 0;% expno = 33; Imin = .1; Imax = 1;% % expno = 34; Imin = .12; Imax = 1;% expno = 45; Imin = .05; Imax = 1;% expno = 44; Imin = .1; Imax = 1;% cd(['/Users/daniel/NMRdata/AVII500/DT/'])%ExpNam = {'CPMAS4mm_setup'};% expno = 35:36;% basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];% lb = 20;% si = 2*1024;% ppmshift = 0;% lb1 = 10;% si1 = 512;% ppmshift1 = 0;% % ExpNam = {'C10E4relax'};% expno = 26;% basl = [.02 .1 .14 .2 .37 .68 .72 .79 .86 .98];% lb = 2;% si = 32*1024;% ppmshift = 0;% lb1 = 5;% si1 = 2*512;% ppmshift1 = 0;% % ExpNam = {'C8G2RH97'};% expno = 33;% expno = 61;% basl = [.02 .1 .13 .18 .28 .50 .67 .82 .87 .98];% lb = 20;% si = 16*1024;% ppmshift = -.1;% lb1 = 10;% si1 = 1*512;% ppmshift1 = -2.6;% ExpNam = {'Efree4mm_setup'};% expno = 11;% basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];% si = 4*1024; lb = 5;% si1 = 1024; lb1 = 5;% Imin = .05; Imax = 1;% expno = 24;% basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];% si = 4*1024; lb = 5;% si1 = 1024; lb1 = 5; ppmshift1 = .9-2.98;% Imin = .05; Imax = 1;% ExpNam = {'Pstarch'};% expno = 49;% basl = [.05 .3 .6 .95];% si = 2*1024; lb = 50;% si1 = 64; lb1 = 20;% Imin = .1; Imax = 1;% ExpNam = {'Pstarch_hetcor'};% expno = 6:25; expno = 28:32;% basl = [.02 .08 .15 .3 .5 .8 .92 .98];% si = 4*1024; lb = 2;% si1 = 128; lb1 = 20;% Imin = .2; Imax = 1;cd(ExpNam{1})if exist('expno') == 0    GetExpnosendfor nexp = 1:length(expno)    ConvertAcqus = 'Y';    ConvertProcs = 'Y';    MakeTextfile = 'N';    if exist([num2str(expno(nexp)) '/NMRacqus.mat']) == 0        ConvertAcqus = 'Y';    end    res = fExpnoInfo2(ConvertAcqus,MakeTextfile,ConvertProcs,expno(nexp));    eval(['load ' num2str(expno(nexp)) '/NMRacqus'])        if any(strcmp(NMRacqus.pulprog,{'DT_hetcorin','DT_hetcorcp','DT_sdhetcorin','DT_sdhetcorcp','DT_edumbosdhetcorcp','DT_edumbosdhetcorcpdr','DT_sdhetcorcpdr','lghetfq','lghetfq_SD.bpe','hxinept2D','hXHETCORlgcp.cp.2023'}) == 1)        Spec2Dtd1         Icos = real(Itd1(:,1:2:(td1-1)));        Isin = real(Itd1(:,2:2:td1));        Icos(:,2:2:(td1/2)) = -Icos(:,2:2:(td1/2));        Isin(:,2:2:(td1/2)) = -Isin(:,2:2:(td1/2));        I = Icos + 1i*Isin;        Itd1 = I;        Stemp = sum(I,1);%         figure(1), clf, plot(1:length(Stemp),real(Stemp),'-o',1:length(Stemp),imag(Stemp),'-o'), return        if exist('lb1') == 0, lb1 = 0; end%         lbfun1 = exp(-lb1*pi*t1);        lbfun1 = cos(pi/2*t1/max(t1)).^2;        Stemp = lbfun1.*Stemp;%         figure(1), clf, plot(t1,real(Stemp),t1,lbfun1*max(real(Stemp))), return        Stemp(1) = 0.5*Stemp(1);        Itemp = fftshift(fft(Stemp,si1));%         figure(1), clf, plot(real(Itemp)), return        Iproj1 = real(Itemp); Iproj1 = Iproj1/max(Iproj1);        Stemp1 = I;%        [dummy,t1array] = ndgrid(1:si,t1);%         lbfun1 = exp(-lb1*pi*t1array);        lbfun1 = repmat(lbfun1,[si 1]);        Stemp1 = lbfun1.*Stemp1;        Stemp1(:,1) = 0.5*Stemp1(:,1);        I = fftshift(fft(Stemp1,si1,2),2);        I = real(I);    %    figure(1), clf, plot(1:td1/2,Stemp1(896,:)), return    %    figure(1), clf, plot(1:si,I(:,si1)), set(gca,'XDir','reverse'), return    %    figure(1), clf, plot(1:si1,I(896,:)), set(gca,'XDir','reverse'), return        %figure(1), clf, surf(I), view(0,90), shading('flat'), return%         if exist('ppmmin') == 0            ppmmin = min(ppm);            ppmmax = max(ppm);            ppmmin1 = min(ppm1);            ppmmax1 = max(ppm1);%         end                maxI = max(I,[],'all');        stdnoise = std(I(baslpoints,:),0,'all');        if exist('Imin') == 0            Imin = 5*stdnoise/maxI;        end        if exist('Imax') == 0            Imax = 1;        end        minI = Imin*max(max(I));        Iplot = I; %Iplot(find(Iplot<minI)) = minI;        Iplot = Iplot/max(max(Iplot));    %        Iproj = max(I,[],2); Iproj = Iproj/max(Iproj(find(ppm>ppmmin&ppm<ppmmax)));    %        Iproj1 = max(I,[],1); Iproj1 = Iproj1/max(Iproj1(find(ppm1>ppmmin1&ppm1<ppmmax1)));        Iproj = max(I(:,find(ppm1>ppmmin1&ppm1<ppmmax1)),[],2); Iproj = Iproj/max(Iproj(find(ppm>ppmmin&ppm<ppmmax)));        Iproj1 = max(I(find(ppm>ppmmin&ppm<ppmmax),:),[],1); Iproj1 = Iproj1/max(Iproj1(find(ppm1>ppmmin1&ppm1<ppmmax1)));        fs = 12;        lw = 1;        figure(1), clf        axes('position',[.2 .15 .73 .65])        contour(ppm,ppm1,Iplot',logspace(log10(Imin),log10(Imax),10),'k','LineWidth',.5)        axis([ppmmin ppmmax ppmmin1 ppmmax1 -.05 1.02])        view(0,90), shading('interp')        set(gca,'XDir','reverse','YDir','reverse','YAxisLocation','right','TickDir','out','Box','on','LineWidth',lw,'FontSize',fs)        grid('off')        set(gca,'LineWidth',lw)        xlabel(['\delta(' NMRacqus.nuc1 ') / ppm'],'FontSize',fs)        ylabel(['\delta(' NMRacqus.nuc2 ') / ppm'],'FontSize',fs)        colormap('hot')        hold on        plot3([ppmmax ppmmin ppmmin], [ppmmax1 ppmmax1 ppmmin1], [1 1 1],'k-','LineWidth',lw)        hold off        axes('position',[.2 .81 .73 .19])        plot(ppm,Iproj,'k','LineWidth',lw)        set(gca,'XDir','reverse')        axis([ppmmin ppmmax Imax*[-.02 1.02]])        axis off        axes('position',[.0 .15 .2 .65])        plot(Iproj1,ppm1,'k','LineWidth',lw)        set(gca,'XDir','reverse','YDir','reverse')        axis([Imax*[-.02 1.02] ppmmin1 ppmmax1])        axis off        if MkReportFig            delete([num2str(expno(nexp)) '/ReportFig.*'])            aspect = 1.6;            set(gcf, 'PaperUnits','centimeters','PaperPosition', 2*8.3*[0 0 1 1/aspect],'PaperSize', 2*8.3*[1 1/aspect]);            eval(['print -dpdf -loose ' num2str(expno(nexp)) '/ReportFig'])        end        if SvSpecDataMat            Spec.I = I;            Spec.ppm = ppm;            Spec.ppm1 = ppm1;            save([num2str(expno(nexp)) '/SpecDat.mat'],'Spec')            Spectd1.I = Itd1;            Spectd1.ppm = ppm;            Spectd1.t1 = t1;            save([num2str(expno(nexp)) '/Spectd1Dat.mat'],'Spectd1')        end    endendcd(wd)