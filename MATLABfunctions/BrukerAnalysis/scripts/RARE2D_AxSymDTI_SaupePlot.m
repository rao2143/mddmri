clear allwd = cd;%DataDir = '/opt/topspin2/data/DT/nmr';DataDir = '/Users/daniel/NMRdata/AVII500/DT';%ExpNam = 'C14E5_6'; expno = 11;%ExpNam = 'AOToct8'; expno = 11;%ExpNam = 'AOToct9'; expno = 11;ExpNam = 'C14E5_7'; expno = 17; %Pixel.x = [67; 67; 70; 93]; Pixel.y = [20; 37; 76; 86];cd([DataDir '/' ExpNam])eval(['load ' num2str(expno) '/NMRacqus'])eval(['load ' num2str(expno) '/Images'])delete([num2str(expno) '/*.eps'])Images.Dxyz.r = Images.lambda1;Images.Dxyz.x = Images.Dxx./Images.Dxyz.r;Images.Dxyz.y = Images.Dyy./Images.Dxyz.r;Images.Dxyz.z = Images.Dzz./Images.Dxyz.r;ADCmax = max(reshape(Images.MD,numel(Images.MD),1));Dmax = max([max(reshape(Images.Dxx,numel(Images.MD),1)) max(reshape(Images.Dyy,numel(Images.MD),1)) max(reshape(Images.Dzz,numel(Images.MD),1))]);Images.DeltaK_gamma = (Images.mu2a_gamma-Images.mu2i)./Images.MD_gamma.^2;Images.DeltaK_erf = Images.mu2a_erf./Images.MD_erf.^2;Images.K_aniso = Images.mu2a_gamma./Images.MD_gamma.^2;Images.DeltaK_FA = 1./(5/2*(1./(Images.FA/sqrt(3/2)).^2 - 1));Images.OD = (Images.uFA_gamma - Images.FA)./Images.uFA_gamma;%Images.OP = sqrt(Images.DeltaK_FA./Images.DeltaK_gamma);Images.OP_gamma = sqrt(Images.DeltaK_FA./Images.DeltaK_gamma);Images.OP_erf = sqrt(Images.DeltaK_FA./Images.DeltaK_erf);Images.Saupe.lambda1 = (Images.lambda1./Images.MD - 1)./Images.DDelta/2;Images.Saupe.lambda2 = (Images.lambda2./Images.MD - 1)./Images.DDelta/2;Images.Saupe.lambda3 = (Images.lambda3./Images.MD - 1)./Images.DDelta/2;indx = isnan(Images.Saupe.lambda1) == 1;Images.Saupe.lambda1(indx) = 0;Images.Saupe.lambda2(indx) = 0;Images.Saupe.lambda3(indx) = 0;[Ni,Nj] = size(Images.Saupe.lambda1);Images.Saupe.SZZ = zeros(Ni,Nj);Images.Saupe.SXX = zeros(Ni,Nj);Images.Saupe.SYY = Images.Saupe.lambda2;for ni = 1:Ni    for nj = 1:Nj        if abs(Images.Saupe.lambda1(ni,nj)) > abs(Images.Saupe.lambda3(ni,nj))            Images.Saupe.SZZ(ni,nj) = Images.Saupe.lambda1(ni,nj);            Images.Saupe.SXX(ni,nj) = Images.Saupe.lambda3(ni,nj);        else            Images.Saupe.SZZ(ni,nj) = Images.Saupe.lambda3(ni,nj);            Images.Saupe.SXX(ni,nj) = Images.Saupe.lambda1(ni,nj);        end    endendImages.Saupeprim.xx = ((Images.Dxx./Images.MD - 1)./Images.DDelta + 1)/3;Images.Saupeprim.yy = ((Images.Dyy./Images.MD - 1)./Images.DDelta + 1)/3;Images.Saupeprim.zz = ((Images.Dzz./Images.MD - 1)./Images.DDelta + 1)/3;Images.Saupeprim.lambda1 = ((Images.lambda1./Images.MD - 1)./Images.DDelta + 1)/3;Images.Saupeprim.lambda2 = ((Images.lambda2./Images.MD - 1)./Images.DDelta + 1)/3;Images.Saupeprim.lambda3 = ((Images.lambda3./Images.MD - 1)./Images.DDelta + 1)/3;Images.Saupeprim.R = zeros(Ni,Nj);Images.Saupeprim.G = zeros(Ni,Nj);Images.Saupeprim.B = zeros(Ni,Nj);for ni = 1:Ni    for nj = 1:Nj        if abs(Images.Saupeprim.lambda1(ni,nj)) > abs(Images.Saupeprim.lambda3(ni,nj))            Images.Saupeprim.R(ni,nj) = Images.Saupeprim.xx(ni,nj)./Images.Saupeprim.lambda1(ni,nj);            Images.Saupeprim.G(ni,nj) = Images.Saupeprim.yy(ni,nj)./Images.Saupeprim.lambda1(ni,nj);            Images.Saupeprim.B(ni,nj) = Images.Saupeprim.zz(ni,nj)./Images.Saupeprim.lambda1(ni,nj);        else            Images.Saupeprim.R(ni,nj) = Images.Saupeprim.xx(ni,nj)./Images.Saupeprim.lambda3(ni,nj);            Images.Saupeprim.G(ni,nj) = Images.Saupeprim.yy(ni,nj)./Images.Saupeprim.lambda3(ni,nj);            Images.Saupeprim.B(ni,nj) = Images.Saupeprim.zz(ni,nj)./Images.Saupeprim.lambda3(ni,nj);        end    endend%Images.OD = (Images.uFA_gamma - Images.FA);Images.K = Images.Ki + Images.Ka_gamma;% figure(1), clf, imagesc(Images.mu2i')% set(gca,'YDir','normal'), axis square% hold on% plot(47,91,'kx')% return%uFA = sqrt(3/2)*sqrt(1/(1+2/5*mD_gamma^2/(mu2_aniso-mu2_iso)));%figure(1), clf, plot(Images.K_aniso,Images.K,'.'), return%figure(1), clf, plot(Images.FA,Images.DeltaK_gamma,'.'), returnCmax = 1;ADCmax = 2e-9;%Dmax = 2e-9;%maskbin = [Images.S0 > .15*max(max(Images.S0)) & Images.FA>0.2];%maskbin = [Images.S0 > .15*max(max(Images.S0)) & Images.uFA_gamma>0.4];% maskbin = [Images.S0 > .1*max(max(Images.S0)) & Images.uFA_gamma>0.7...%     & Images.FA>0.5 & Images.K<.03];% maskbin = [Images.S0 > .1*max(max(Images.S0)) & Images.uFA_gamma>0.65...%     & Images.FA<0.1 & Images.K<.02];maskbin = [Images.S0 > .05*max(max(Images.S0))];% maskbin = [Images.S0 > .1*max(max(Images.S0)) & Images.K>.15 ...%     & Images.K_aniso>.45 & Images.DeltaK_gamma>.2];%maskbin = [Images.S0 > .14*max(max(Images.S0)) & Images.DeltaK_gamma>0.15];%maskbin = [Images.S0 > .05*max(max(Images.S0)) & Images.MD_gamma < 1e-9];%maskbin = ones(size(Images.S0));mask = find(maskbin);[mask_x,mask_y] = find(maskbin);invmask = find(maskbin==0);%%height = .7;width = height*8.5/11;dleft = width+.05;dbottom = .3;hwidth = .7*width;hheight = height-dbottom;fs = 16*11/3.33; lw = 2*11/3.33; tl = .04;Xshift = -5;left = 0;bottom = 1-height;figure(3), clfcolormap(gray(256))axes('position',[left bottom width height])Iplot = squeeze(Images.S0_gamma(:,:));%Iplot = squeeze(Images.MD(:,:));Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);clim = [0 max(max(Images.S0_gamma))];imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.S0_gamma,numel(Images.FA),1)/max(clim);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistS0 -loose -dpdf'])figure(3), clfcolormap(gray(256))axes('position',[left bottom width height])Iplot = squeeze(Images.MD_gamma(:,:));%Iplot = squeeze(Images.MD(:,:));Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);clim = [0 ADCmax];imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = 1/1e-9*reshape(Images.MD_gamma,numel(Images.FA),1);%histdat = 1/1e-9*reshape(Images.MD,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 2*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistMD_gamma -loose -dpdf'])figure(3), clfcolormap(gray(256))axes('position',[left bottom width height])Iplot = squeeze(Images.MD_erf(:,:));%Iplot = squeeze(Images.MD(:,:));Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);clim = [0 ADCmax];imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = 1/1e-9*reshape(Images.MD_erf,numel(Images.FA),1);%histdat = 1/1e-9*reshape(Images.MD,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 2*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistMD_erf -loose -dpdf'])figure(3), clfcolormap(gray(256))axes('position',[left bottom width height])Iplot = squeeze(Images.FA(:,:));Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);clim = [0 1];imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.FA,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistFA -loose -dpdf'])figure(3), clfcolormap(gray(256))axes('position',[left bottom width height])Iplot = squeeze(Images.CP(:,:));Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);clim = [0 1];imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.CP,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistCP -loose -dpdf'])figure(3), clfcolormap(gray(256))axes('position',[left bottom width height])Iplot = squeeze(Images.CL(:,:));Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);clim = [0 1];imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.CL,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistCL -loose -dpdf'])figure(3), clfcolormap(gray(256))axes('position',[left bottom width height])Iplot = squeeze(Images.K_aniso(:,:));Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);clim = [0 1];imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.K_aniso,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistK_aniso -loose -dpdf'])figure(3), clfcolormap(gray(256))axes('position',[left bottom width height])Iplot = squeeze(Images.K(:,:));Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);clim = [0 1];imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.K,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistK_iso -loose -dpdf'])figure(3), clfcolormap(gray(256))axes('position',[left bottom width height])Iplot = squeeze(Images.DeltaK_gamma(:,:));Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);clim = [0 1];imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.DeltaK_gamma,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistDeltaK_gamma -loose -dpdf'])%%maskbin = [Images.S0 > .05*max(max(Images.S0)) & Images.DeltaK_gamma>0];mask = find(maskbin);invmask = find(maskbin==0); figure(3), clfaxes('position',[left bottom width height])clim = [0 Cmax];Iplot = squeeze(Images.FA(:,:))/max(clim);Iplot(invmask) = 0;Iplot2 = zeros([fliplr(size(Images.FA)) 3]);Iplot2(:,:,1) = (Iplot.*Images.Dxyz.x)';Iplot2(:,:,2) = (Iplot.*Images.Dxyz.y)';Iplot2(:,:,3) = (Iplot.*Images.Dxyz.z)';Iplot2(find(Iplot2>1)) = 1;Iplot2(find(Iplot2<0)) = 0;Iplot2 = circshift(Iplot2,[0 Xshift]);imagesc(r.i*1e3,r.j*1e3,Iplot2,clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.FA,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistFAcolor -loose -dpdf'])figure(3), clfaxes('position',[left bottom width height])clim = [0 Cmax];Iplot = squeeze(Images.uFA_gamma(:,:))/max(clim);Iplot(invmask) = 0;Iplot2 = zeros([fliplr(size(Images.FA)) 3]);Iplot2(:,:,1) = (Iplot.*Images.Dxyz.x)';Iplot2(:,:,2) = (Iplot.*Images.Dxyz.y)';Iplot2(:,:,3) = (Iplot.*Images.Dxyz.z)';Iplot2(find(Iplot2>1)) = 1;Iplot2(find(Iplot2<0)) = 0;Iplot2 = circshift(Iplot2,[0 Xshift]);imagesc(r.i*1e3,r.j*1e3,Iplot2,clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.uFA_gamma,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistuFA_gammacolor -loose -dpdf'])figure(3), clfaxes('position',[left bottom width height])clim = [0 Cmax];Iplot = squeeze(Images.uFA_erf(:,:))/max(clim);Iplot(invmask) = 0;Iplot2 = zeros([fliplr(size(Images.FA)) 3]);Iplot2(:,:,1) = (Iplot.*Images.Dxyz.x)';Iplot2(:,:,2) = (Iplot.*Images.Dxyz.y)';Iplot2(:,:,3) = (Iplot.*Images.Dxyz.z)';Iplot2(find(Iplot2>1)) = 1;Iplot2(find(Iplot2<0)) = 0;Iplot2 = circshift(Iplot2,[0 Xshift]);imagesc(r.i*1e3,r.j*1e3,Iplot2,clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.uFA_erf,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistuFA_erfcolor -loose -dpdf'])%%figure(3), clfaxes('position',[left bottom width height])clim = [0 Cmax];Iplot = ones(size(Images.uFA_erf(:,:)));%Iplot = squeeze(Images.OP_erf(:,:))/max(clim);%Iplot = squeeze(Images.Saupe.SZZ(:,:))/max(clim);Iplot(invmask) = 0;IplotC = zeros([fliplr(size(Images.FA)) 3]);% IplotC(:,:,1) = (Images.Saupe.xx./Images.OP_erf);% IplotC(:,:,2) = (Images.Saupe.yy./Images.OP_erf);% IplotC(:,:,3) = (Images.Saupe.zz./Images.OP_erf);IplotC(:,:,1) = Images.Saupeprim.R;IplotC(:,:,2) = Images.Saupeprim.G;IplotC(:,:,3) = Images.Saupeprim.B;Iplot2 = zeros([fliplr(size(Images.FA)) 3]);Iplot2(:,:,1) = (Iplot.*IplotC(:,:,1))';Iplot2(:,:,2) = (Iplot.*IplotC(:,:,2))';Iplot2(:,:,3) = (Iplot.*IplotC(:,:,3))';Iplot2(find(Iplot2>1)) = 1;Iplot2(find(Iplot2<0)) = 0;Iplot2 = circshift(Iplot2,[0 Xshift]);imagesc(r.i*1e3,r.j*1e3,Iplot2,clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.Saupe.SZZ,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.6 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistSaupecolor -loose -dpdf'])%%figure(3), clfaxes('position',[left bottom width height])clim = [0 Cmax];Iplot = squeeze(Images.FA(:,:))/max(clim);Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.FA,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistFAbw -loose -dpdf'])figure(3), clfaxes('position',[left bottom width height])clim = [0 Cmax];Iplot = squeeze(Images.uFA_gamma(:,:))/max(clim);Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.uFA_gamma,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.2 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistuFA_gammabw -loose -dpdf'])%%figure(3), clfaxes('position',[left bottom width height])clim = [0 Cmax];Iplot = squeeze(abs(Images.Saupe.SZZ(:,:)))/max(clim);Iplot(invmask) = 0;Iplot = circshift(Iplot,Xshift);imagesc(r.i*1e3,r.j*1e3,Iplot',clim)set(gca,'YDir','normal')axis equal, axis tight, axis offhold onif exist('Pixel')    for npix = 1:length(Pixel.x)        plot(r.i(Pixel.x(npix))*1e3,r.j(Pixel.y(npix))*1e3,'rx','LineWidth',lw)    endendhistdat = reshape(Images.Saupe.SZZ,numel(Images.FA),1);histdat = histdat(mask);axes('position',[1-hwidth+.015 bottom+dbottom hwidth hheight])hist(histdat,100);axis tightylim = get(gca,'YLim');ylim = ylim(2)*[0 1.1];xlim = 1*[-.6 1.2];set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',ylim,'YTick',[],'YAxisLocation','right')set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ImagHistOP_erfbw -loose -dpdf'])%%histdat1 = reshape(Images.FA,numel(Images.FA),1);histdat1 = histdat1(mask);histdat2 = reshape(Images.uFA_gamma,numel(Images.FA),1);histdat2 = histdat2(mask);figure(3), clfaxes('position',[1-width 1-height width height])plot([0 1],[0 1],'k-','LineWidth',lw)hold onplot([0 1],1/sqrt(2)*[1 1],'k--','LineWidth',lw)plot([0 1],1*[1 1],'k--','LineWidth',lw)plot(histdat1,histdat2,'b.','MarkerSize',lw)set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',xlim)set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ScatterFAuFAgamma -loose -dpdf'])histdat1 = reshape(Images.FA,numel(Images.FA),1);histdat1 = histdat1(mask);histdat2 = reshape(Images.uFA_erf,numel(Images.FA),1);histdat2 = histdat2(mask);figure(3), clfaxes('position',[1-width 1-height width height])plot([0 1],[0 1],'k-','LineWidth',lw)hold onplot([0 1],1/sqrt(2)*[1 1],'k--','LineWidth',lw)plot([0 1],1*[1 1],'k--','LineWidth',lw)plot(histdat1,histdat2,'b.','MarkerSize',lw)set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',xlim,'YLim',xlim)set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ScatterFAuFAerf -loose -dpdf'])histdat1 = reshape(Images.OP_gamma,numel(Images.FA),1);histdat1 = histdat1(mask);histdat2 = reshape(Images.Saupe.SZZ,numel(Images.FA),1);histdat2 = histdat2(mask);figure(3), clfaxes('position',[1-width 1-height width height])plot(histdat1,histdat2,'b.','MarkerSize',lw)hold on% plot([0 1],[0 1],'k-','LineWidth',lw)% plot([0 1],1/sqrt(2)*[1 1],'k--','LineWidth',lw)% plot([0 1],1*[1 1],'k--','LineWidth',lw)set(gca,'Box','off','TickDir','out','TickLength',tl*[1 1],...    'FontSize',fs,'LineWidth',lw,...    'XLim',[-1.2 1.2],'YLim',[-1.2 1.2])set(gcf, 'PaperPosition', [0 0 11 8.5],'PaperSize', [11 8.5]); eval(['print ' num2str(expno) '/ScatterOPSZZ -loose -dpdf'])%%cd(wd)