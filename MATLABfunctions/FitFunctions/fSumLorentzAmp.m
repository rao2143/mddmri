function Y = fSumLorentzAmp(Pin,Xin,Npeaks,Ntd1,si,offset,width,Pnorm,Xnorm,Ynorm);Pin = Pin.*Pnorm;Xin = Xin*Xnorm;Xin = reshape(Xin,si,Ntd1);Pin = reshape(Pin,numel(Pin)/Npeaks,Npeaks);nu = Xin(1:si);amplArray = Pin(1,:);T2 = pi./width;[nuArray,amplArray] = ndgrid(nu,reshape(amplArray,1,Npeaks*Ntd1));amplArray = reshape(amplArray,si,Ntd1,Npeaks);[nuArray,td1Array,offsetArray] = ndgrid(nu,1:Ntd1,offset);[nuArray,td1Array,T2Array] = ndgrid(nu,1:Ntd1,T2);phase = 0;IArray = amplArray.*T2Array./(1+(nuArray-offsetArray).^2.*T2Array.^2)...    .*(1 - i*(nuArray-offsetArray).*T2Array)*exp(i*phase);Icalc = sum(IArray,3);Icalc = real(Icalc);% figure(1), clf% plot(nu,Icalc)% pause(.1)Y = Icalc/Ynorm;Y = reshape(Y,numel(Y),1);