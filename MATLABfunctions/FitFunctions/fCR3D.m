function Y = fCR3D(Pin,Xin,C,kwkc,delta,tao2,DELTA,Pnorm,Xnorm,Ynorm)k = Xin*Xnorm;Pin = Pin.*Pnorm;Dmean = Pin(1);A = Pin(2);I0 = Pin(3:length(Pin));[temp, I0] = ndgrid(ones(length(k)/length(I0),1), I0);I0 = reshape(I0,prod(size(I0)),1);Dperp = 3*Dmean/(2+A);Dpar = A*Dperp;N = 100;M = 200;sigma = 0.02;theta = linspace(0,pi/2,M+1);dtheta = diff(theta);theta = theta(1:M) + dtheta;D = logspace(log10(min([Dperp Dpar]))-0.1,log10(max([Dperp Dpar]))+0.1,N+1)';dD = diff(D);D = D(1:N) + dD;[Darray,thetaarray] = ndgrid(D,theta);wtheta = sin(thetaarray);Dmax = Dpar*cos(thetaarray).^2+Dperp*sin(thetaarray).^2;D0 = Dmax*exp(sigma^2);SD = wtheta.*1./(Darray*sigma*sqrt(2*pi)).*exp(-0.5*((log(Darray) - log(D0))/sigma).^2);PD = SD*dtheta';[karray, Darray] = ndgrid(k,D);[DELTAarray, PDarray] = ndgrid(DELTA,PD);[tao2array, PDarray] = ndgrid(tao2,PD);A = karray.*Darray./(DELTAarray-delta/3);B = sqrt((A + C).^2 + 4*kwkc);B0 = sqrt(C.^2 + 4*kwkc);EkD = exp(-karray.*Darray).*exp(A.*tao2array/2).*(cosh(B.*tao2array/2)-(A+C)./B.*sinh(B.*tao2array/2))./(cosh(B0.*tao2array/2)-C./B0.*sinh(B0.*tao2array/2));EkD(find(isnan(EkD)==1)) = 0;EkD(find(EkD==Inf)) = 0;Ek = (PDarray.*EkD)*dD;%figure(1), semilogy(k,Ek,'o'), returnIk = I0.*Ek;Y = Ik/Ynorm;