function Y = fSumLorentz2D(Pin,Xin,Para,Pnorm);if nargin == 3    Pnorm.P = ones(size(Pin));    Pnorm.X = 1;    Pnorm.Y = 1;end       Pin = Pin.*Pnorm.P;Xin = reshape(Xin,Para.si,Para.Ntd1)*Pnorm.X;nu = Xin(:,1);Pin = reshape(Pin,Para.Npeaks,numel(Pin)/Para.Npeaks);offset = Pin(:,1)';width = Pin(:,2)';amplArray = Pin(:,2+(1:Para.Ntd1))';T2 = pi./width;[nuArray,amplArray] = ndgrid(nu,reshape(amplArray,1,Para.Npeaks*Para.Ntd1));amplArray = reshape(amplArray,Para.si,Para.Ntd1,Para.Npeaks);[nuArray,td1Array,offsetArray] = ndgrid(nu,1:Para.Ntd1,offset);[nuArray,td1Array,T2Array] = ndgrid(nu,1:Para.Ntd1,T2);phase = 0;IArray = amplArray.*T2Array./(1+(nuArray-offsetArray).^2.*T2Array.^2)...    .*(1 - i*(nuArray-offsetArray).*T2Array)*exp(i*phase);Icalc = sum(IArray,3);Icalc = real(Icalc);% figure(1), clf% plot(nu,Icalc)% pause(.1)Y = Icalc/Pnorm.Y;Y = reshape(Y,numel(Y),1);